---
title: "Homeownership Rates"
subtitle: "Visuals for Equity Tracker (PUMS data)"
author: "Meg Grzybowski"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    keep_md: yes
    df_print: paged
    toc: yes
    toc_depth: 6
    toc_float: yes
  word_document:
---

```{r rmarkdown setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, 
                      warning=FALSE, 
                      message=FALSE) # formatting

# to reference chart functions in Github
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r library setup, include=FALSE}
# devtools::install_github("psrc/psrcplot",
#                          force=TRUE)
library(psrcplot)
library(tidyverse)
library(magrittr)
library(dplyr)

library(sf)
library(leaflet)
library(leafem) #home button
library(htmlwidgets) #save visuals as html

install_psrc_fonts()
library(showtext) #trying to fix PSRC font issues
library(sysfonts) #required for showtext
library(showtextdb) #required for showtext

library(echarts4r)
# remotes::install_github("JohnCoene/echarts4r",
#                         force=TRUE)

library(webshot2) #static image creation
```

```{r, choose output type}
#output_type <- "word"
output_type <- "html"
```
# 3 visuals for webpage
This code will help produce the three visuals that are going to be a part of each equity tracker indicator webpage: regional map (tract level) of most recent data, chart of the most recent data, chart of trends over time.
\
\
**If the indicator is a PUMS/OPSI indicator that can be accessed through Elmer.** Getting the data to a workable version may require some data transformation. To explore, clean, transform, and generate a final data set, please use the *data-gen-pums-template*. This script will generate an .rda for the map and an .rda for the charts. These data sets will be loaded in before the data visualization code.  

## 1. Map of most recent data
To map data in this form, it requires accessing data at the regional/tract level from ACS since the Elmer data set is already aggregated to equity group/quintile. 
```{r map legend settings, include=FALSE}
# https://stackoverflow.com/questions/40276569/reverse-order-in-r-leaflet-continuous-legend - this code helps to set up the legend so that it is arranged high-low with correct color order
addLegend_decreasing <- function (map, position = c("topright", "bottomright", "bottomleft", 
			    "topleft"), pal, values, na.label = "NA", bins = 9, colors, 
		  opacity = 0.5, labels = NULL, labFormat = labelFormat(), 
		  title = NULL, className = "info legend", layerId = NULL, 
		  group = NULL, data = getMapData(map), decreasing = FALSE) {
	position <- match.arg(position)
	type <- "unknown"
	na.color <- NULL
	extra <- NULL
	if (!missing(pal)) {
		if (!missing(colors)) 
			stop("You must provide either 'pal' or 'colors' (not both)")
		if (missing(title) && inherits(values, "formula")) 
			title <- deparse(values[[2]])
		values <- evalFormula(values, data)
		type <- attr(pal, "colorType", exact = TRUE)
		args <- attr(pal, "colorArgs", exact = TRUE)
		na.color <- args$na.color
		if (!is.null(na.color) && col2rgb(na.color, alpha = TRUE)[[4]] == 
		    0) {
			na.color <- NULL
		}
		if (type != "numeric" && !missing(bins)) 
			warning("'bins' is ignored because the palette type is not numeric")
		if (type == "numeric") {
			cuts <- if (length(bins) == 1) 
				pretty(values, bins)
			else bins	
			
			if (length(bins) > 2) 
				if (!all(abs(diff(bins, differences = 2)) <= 
				         sqrt(.Machine$double.eps))) 
					stop("The vector of breaks 'bins' must be equally spaced")
			n <- length(cuts)
			r <- range(values, na.rm = TRUE)
			cuts <- cuts[cuts >= r[1] & cuts <= r[2]]
			n <- length(cuts)
			p <- (cuts - r[1])/(r[2] - r[1])
			extra <- list(p_1 = p[1], p_n = p[n])
			p <- c("", paste0(100 * p, "%"), "")
			if (decreasing == TRUE){
				colors <- pal(rev(c(r[1], cuts, r[2])))
				labels <- rev(labFormat(type = "numeric", cuts))
			}else{
				colors <- pal(c(r[1], cuts, r[2]))
				labels <- rev(labFormat(type = "numeric", cuts))
			}
			colors <- paste(colors, p, sep = " ", collapse = ", ")
			
		}
		else if (type == "bin") {
			cuts <- args$bins
			n <- length(cuts)
			mids <- (cuts[-1] + cuts[-n])/2
			if (decreasing == TRUE){
				colors <- pal(rev(mids))
				labels <- rev(labFormat(type = "bin", cuts))
			}else{
				colors <- pal(mids)
				labels <- labFormat(type = "bin", cuts)
			}
			
		}
		else if (type == "quantile") {
			p <- args$probs
			n <- length(p)
			cuts <- quantile(values, probs = p, na.rm = TRUE)
			mids <- quantile(values, probs = (p[-1] + p[-n])/2, 
				 na.rm = TRUE)
			if (decreasing == TRUE){
				colors <- pal(rev(mids))
				labels <- rev(labFormat(type = "quantile", cuts, p))
			}else{
				colors <- pal(mids)
				labels <- labFormat(type = "quantile", cuts, p)
			}
		}
		else if (type == "factor") {
			v <- sort(unique(na.omit(values)))
			colors <- pal(v)
			labels <- labFormat(type = "factor", v)
			if (decreasing == TRUE){
				colors <- pal(rev(v))
				labels <- rev(labFormat(type = "factor", v))
			}else{
				colors <- pal(v)
				labels <- labFormat(type = "factor", v)
			}
		}
		else stop("Palette function not supported")
		if (!any(is.na(values))) 
			na.color <- NULL
	}
	else {
		if (length(colors) != length(labels)) 
			stop("'colors' and 'labels' must be of the same length")
	}
	legend <- list(colors = I(unname(colors)), labels = I(unname(labels)), 
	               na_color = na.color, na_label = na.label, opacity = opacity, 
	               position = position, type = type, title = title, extra = extra, 
	               layerId = layerId, className = className, group = group)
	invokeMethod(map, data, "addLegend", legend)
}
```

### Create Visual
```{r map .rda}
# load map .rda
base_dir <- 'Y:/Equity Indicators/tracker-webpage-content'
theme_dir <- 'e-housing'
ind_dir <- 'e03-homeownership-rates'
rda <- 'e03-homeownership-rates-map-data.rda'

load(file=file.path(base_dir,theme_dir,ind_dir,"rda-data",rda))
``` 

```{r acs map}
# setting map extent
map.lat<- 47.615
map.lon<- -122.257
map.zoom<- 8.5

# setting color palette
psrc_palette <- leaflet::colorNumeric(palette = psrc_colors$purples_inc,
                                      domain = acs_data_tract$estimate) # this is the value field

# setting the legend/label variables
var_name <- "Housing <br> Tenure" # the <br> could be adjusted depending on the length/spacing of the name

#labels <- sprintf(
 # "Census tract: <em>%s</em><br/><strong>%s</strong>", acs_data_tract$geoid20, # the code in <> makes the geoid value italic
  #paste("$", # if doesn't require prefix, this can be removed
   #     prettyNum((round(acs_data_tract$estimate, digits=-2)),
    #              big.mark = ","))) %>%
  #lapply(htmltools::HTML)

# if the label required a suffix instead of a prefix, for example a %, the code would look like this:
labels <- sprintf(
   "Census tract: <em>%s</em><br/><strong>%s</strong>", acs_data_tract$geoid20,
   paste(prettyNum((round(acs_data_tract$estimate, digits=0)), #the digits would probably be 2 for %
               big.mark = ","), #this wouldn't be necessary to include for %s    
         '%')) %>%
   lapply(htmltools::HTML)


# map settings
acs_map <- leaflet() %>%
  leaflet::addMapPane(name = "polygons", zIndex = 410) %>%
  leaflet::addMapPane(name = "maplabels", zIndex = 500) %>% # higher zIndex rendered on top
  leaflet::addProviderTiles("CartoDB.VoyagerNoLabels") %>%
  leaflet::addProviderTiles("CartoDB.VoyagerOnlyLabels",
                            options = leaflet::leafletOptions(pane = "maplabels"),
                            group = "Labels") %>%
  addPolygons(data=acs_data_tract,
              fillColor = psrc_palette(acs_data_tract$estimate),
              stroke=FALSE, 
              smoothFactor = 0.2,
              fillOpacity = 0.7,
              group = var_name,
              label = labels) %>% 

  # legend
  addLegend_decreasing(pal = psrc_palette,
                       values = acs_data_tract$estimate,
                       position = "bottomright",
                       title = var_name,
                       group = var_name,
                       opacity = 0.7,
                       labFormat = labelFormat(suffix = "%"),
                       decreasing = TRUE) %>% #to get legend high-low with correct color order
  
  # set view extent
  leaflet::setView(lng=map.lon, lat=map.lat, zoom=map.zoom) %>% 
  addEasyButton(easyButton(
    icon = htmltools::span(class = "globe", htmltools::HTML("&#127758;")),  #&#127760; (another emoji option) #"fa-globe", (font awesome icon no longer works because of the conversion to Poppins font below)  
    title ="Region",
    onClick=JS("function(btn, map){map.setView([47.615,-122.257],8.5); }")))

# fixing the legend NA placement (https://github.com/rstudio/leaflet/issues/615)
css_fix <- "div.info.legend.leaflet-control br {clear: both;} html * {font-family: Poppins !important;}" # CSS to correct spacing and font family
html_fix <- htmltools::tags$style(type = "text/css", css_fix) # Convert CSS to HTML
acs_map %<>% htmlwidgets::prependContent(html_fix) # Insert into leaflet HTML code

# printing map
acs_map
```

```{r generate acs map html, include=FALSE}
# to save html visual to folder, you must create an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs

# set folder structure
map_name <- 'e03-homeownership-rates-map.html'
  
# interactive webpage output process
htmlwidgets::saveWidget(acs_map,
                        file=file.path(base_dir,theme_dir,ind_dir, 'webpage-html-outputs', map_name))
```
\
\

#### Data call outs
```{r map calculations - pums, include=FALSE, eval=FALSE}
# simplify data set
data <- acs_data_tract %>%
  st_drop_geometry()

# calculate call out information
# this calculation doesn't work for median income because median is unique - need to retrieve from census
# calc <- data %>% 
#   dplyr::mutate(inc_wt_pop = total_pop20*estimate) %>% 
#   dplyr::mutate(reg_medinc = sum(inc_wt_pop, na.rm=TRUE)/sum(total_pop20, na.rm=TRUE))
# regional median income: 104322.7

x<-rep(data$estimate,times=data$total_pop20)
 df1<-data.frame(x)
 summary(df1$x)
 median(df1$x, na.rm=TRUE)
 hist(df1$x)
# regional median homeownership rates: 67%

# getting data by region from PUMS
#pums_data <- get_psrc_pums(span = 5,
 #                          dyear = 2021,
  #                         level = "h",
   #                        vars = "OWN_RENT")
#reg_count <- psrc_pums_count(pums_data, stat_var = "OWN_RENT")
# regional median income: 96453.13

sort <- data %>% 
  dplyr::arrange(desc(estimate))
# 53061050600 (Woodway and Edmonds Waterfront), 53061042005 (Mukilteo), and 53061052206 (south of Lake Roesiger) in Snohomish County and, 53033032328 (Sammamish) and 53033031709 (west of Covington) in King County
# Snohomish and King County are top 5 highest home-owning counties

sort <- data %>% 
  dplyr::arrange(estimate)
# 53033005304 (Seattle UW), 53033005305 (Seattle UW), 53053061601 (Tacoma)
# 53033030501 (Auburn, around 167)

# this calculation doesn't work for median income because median is unique - need to retrieve from census 
by_county <- data %>% 
   dplyr::group_by(county_name) %>% 
   dplyr::summarise(ownership.wgt=(sum(estimate*total_pop20, na.rm =TRUE))/(sum(total_pop20, na.rm=TRUE))) %>% 
   dplyr::arrange(desc(ownership.wgt))

# getting data by county from acs 
#coutny_acs_data <- get_acs_recs(geography ='county', 
 #                               table.names = 'B19013', #subject table code
  #                              years = c(2021),
   #                             acs.type = 'acs5')
#coutny_acs_data <- coutny_acs_data %>% 
 # dplyr::arrange(desc(estimate))
```

1. 67%: The region's average rate of homeownership
2. 70%: Snohomish County has the highest homeownership rates
3. 59%: King County has the lowest percentage of homeownership rates

\

#### Insights & Analysis

* Snohomish County has the highest homeownership rates (70%), followed by Kitsap (69%), Pierce (65%), and King (59%)
* The five census tracts tied with the highest rates of homeownership (99-97%) are in Snohomish (Woodway and Edmonds Waterfront, Mukilteo, and south of Lake Roesiger) and King County (Sammamish and west of Covington)
* Five census tracts with the lowest homeownership rates are in King County; four in Seattle's University District and one in the South Lake Union neighborhood. Snohomish County is the only county without 0% homeowmership rates

\
\


## 2. Facet of most recent data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r data setup, include=FALSE}
# load visualization functions for charts
source('C:/Coding/CURRENT_REPOS_GITHUB/equity-tracker/data-visualization/equity-tracker-chart-functions.R')
#source('equity-tracker-chart-functions.R')

# set folder structure
rda <- 'e03-homeownership-rates-data.rda'

load(file=file.path(base_dir,theme_dir,ind_dir,"rda-data",rda))
```

```{r column facet - pums}
# Create Facet Column Chart
data_clean_column <- data_clean %>% 
  dplyr::filter(data_year=="2021") #filter on most recent year

# set variables 
df = data_clean_column
geo = "county"
x = "focus_attribute_ord"
y = "fact_value"
facet = "focus_type_ord"
fill = "focus_attribute_ord"
y_min = 0
y_max = 1
dec = 0
esttype = "percent"
color = "purples"
title = "Homeownership Rates"
subtitle = "percentage"
source = "U.S. Census Bureau, American Community Survey (ACS) 5-Year Public Use Microdata Sample (PUMS)"

column_chart <- equity_tracker_column_facet(df = df,
                                            geo = geo,
                                            x = x,
                                            y = y,
                                            facet = facet,
                                            title = title,
                                            y_min = y_min,
                                            y_max = y_max,
                                            dec = dec,
                                            esttype = esttype,
                                            color = color)

```

```{r output final column chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\static-images

# set folder structure
file_name <- 'e03-homeownership-rates-column'

# column Chart - html for interactive
rmarkdown::render("C:/Coding/CURRENT_REPOS_GITHUB/equity-tracker/data-visualization/equity-tracker-chart-creator.RMD", 
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                title = title,
                                source = source,
                                subtitle = subtitle),
                  output_file = paste0(file_name, '.html'),
                  output_dir = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs'))

# Column Chart - png for use in static file
# need to create a 'static-images' sub-folder in theme sub-folder if not already existing
webshot2::webshot(url = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs', paste0(file_name, '.html')), 
                  file = file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')), 
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r column chart output - pums, echo=FALSE}

if (output_type == "html") {

  column_chart  
  
} else {
  
  knitr::include_graphics(file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')))
  
}

# column_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">
`r source`
</p> 

#### Data call outs
```{r column facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean_column %>% 
  filter(county=="Region",
         focus_type=="Income_cat")

# region low income households: 33	
# region non-low income households: 67
# 67-33= 34%

filter <- data_clean_column %>% 
  filter(focus_type=="LEP_cat",
         county=="Region")
# region lep households: 41	
# region non-lep households: 62
# 62-41= 23%

filter <- data_clean_column %>% 
  filter(focus_type=="LEP_cat",
         vulnerability=="high vulnerability")

# region lep households: 41%	
# kitsap lep households: 60%
# 21%

filter <- data_clean_column %>% 
  filter(county=="Region",
         focus_type=="Youth_cat")

filter <- data_clean_column %>% 
  filter(focus_type=="POC_cat")

# king 16
# kitsap 19
# pierce 19
# snohomish 10
# region 16

filter <- data_clean_column %>% 
  filter(focus_type=="Disability_cat")
# kitsap dis: 84171.34
# kitsap non-dis: 104284.10
# 104284.10-84171.34=20112.76

# king dis: 81508.16
# king non-dis: 134637.12
# 134637.12-81508.16=53128.96

filter <- data_clean_column %>% 
  filter(focus_type=="Income_cat",
         vulnerability=="high vulnerability") %>% 
  dplyr::arrange(desc(fact_value))

```

1. 34%: Difference between regional homeownership rates for households living above or below 200% of federal poverty level
2. 66%: Median homeownership rates of households living with children (below 18 years old) is 66%, only 7 percentage points higher than households without children
3. 23%: Limited English proficient households have homeownership rates 23 percentage points lower than English proficient households


\

#### Insights & Analysis

* For households living below 200% federal poverty level, homeownership rates were highest in Kitsap County (42%) followed by Pierce (38%), Snohomish (37%), and King (29%) 
* The largest difference in homeownership rates between people of color and white non-Hispanic is in Kitsap and Pierce County (19 percentage points), while the smallest difference is in Snohomish County (10 percentage points)
* King County is the only county where English proficient households have lower homeownership rates (39%) than the region's limited English proficient households (41%)

\
\


## 3. Facet of trend data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r line facet - pums, include=FALSE}
# Create Facet Line Chart

# set variables
df = data_clean
x = "data_year" # different from variables for facet column
fill = "focus_attribute_ord" # different from variables for facet column
color = "purples"

line_chart <- equity_tracker_line_facet(df = df,
                                        geo = geo,
                                        x = x,
                                        y = y,
                                        fill = fill,
                                        facet = facet,
                                        y_min = y_min,
                                        y_max = y_max,
                                        dec = dec,
                                        esttype = esttype,
                                        color = color,
                                        width = '420px',
                                        height = '380px')
```

```{r output final line chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\static-images

# set folder structure
file_name <- 'e03-homeownership-rates-line'

# Line Chart - html for interactive
rmarkdown::render("C:/Coding/CURRENT_REPOS_GITHUB/equity-tracker/data-visualization/equity-tracker-chart-creator.RMD", 
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                fill = fill,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                title = title,
                                source = source,
                                subtitle = subtitle,
                                width = '420px',
                                height = '380px',
                                charttype = "line"),
                  output_file = paste0(file_name, '.html'),
                  output_dir = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs'))

# Line Chart - png for use in static file
webshot2::webshot(url = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs', paste0(file_name, '.html')), 
                  file = file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')), 
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r line chart - pums, echo=FALSE}
if (output_type == "html") {

  line_chart  
  
} else {
  
  knitr::include_graphics(file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')))
  
}
# line_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">
`r source`
</p> 

#### Data call outs
```{r line facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="Income_cat")
# 2021 low income: 33
# 2021 non-low income: 67
# 67-33=34
# 2011 low income: 36
# 2011 non-low income: 75
# 75-36=39
# ((34-39)/(39))*100: -13% change


filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="POC_cat")
# 2021 poc: 102481.29
# 2021 non-poc: 118053.44
# 118053.44-102481.29=15572.15

filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="Older_cat")
# 2021 older: 83306.58
# 2021 non-older: 124514.77
# 124514.77-83306.58=41208.19
# 2011 older: 62308.22
# 2011 non-older: 94026.28
# 94026.28-62308.22= 31718.06
# ((41208.19-31718.06)/(31718.06))*100: 29.92027% change

filter <- data_clean %>%
  filter(county != "Region",
         focus_type=="Disability_cat")
# 2016 king disability-no disability: 102202.57-62990.64=39211.93
# 2021 king disability-no disability: 134637.12-81508.16=53128.96
# 53128.96-39211.93=13917.03

filter <- data_clean %>%
  filter(focus_type=="POC_cat")
# 2011 king:70-50=20
# 2021 king:62-46=16
# ((16-20)/(20))*100: -20% change
# 2011 kitsap:72-53=19
# 2021 kitsap:73-54=19
# ((19-19)/(19))*100: 0% change
# 2011 pierce:70-56=26
# 2021 pierce:69-50=19
# ((19-26)/(26))*100: -27% change
# 2011 snohomish:71-51=20
# 2021 snohomish:71-61=10
# ((10-20)/(20))*100: -50% change

filter <- data_clean %>%
  filter(county=="Snohomish",
         focus_type=="Income_cat",
         vulnerability=="low vulnerability",
         data_year=="2011" |
           data_year=="2021")
# king non-low income:150511.89-98506.82=52005.07
# Snohomish non-low income:130900.06-97445.42=33454.64
```

1. 34%: In 2021, households in the region who were living below 200% federal poverty level had homeownership rates 34 percentage points less than households living above, a 13% smaller gap than in 2011
2. 54%: King County has the lowest rates of homeownership for people living with a disability
3. 20%: Homeownership rates in the region with older adults has remained consistently 20 percentage points lower than households without older adults

\

#### Insights & Analysis

* The difference in homeownership rates for people of color and white non-Hispanic over time has shifted the greatest in Snohomish County (-50%), Pierce County (-27%), and King County (-20%), while remaining unchanged in Kitsap County
* In 2021, people of color have the lowest homeownership rates in King County (46%), and the highest rates of homeownership in Snohomish County (61%)
* The difference in homeownership rates of people with a disability compared to those living without has stayed relatively the same between 2016 and 2021 in all counties, except un Snohomish County, where there has been a 5% increase in homeownership rates for people living with a disability


\
\


# Transfer files
## Copy files from Github > Y drive
```{r to y drive, include=FALSE, eval=FALSE}
# set folder structure
current_folder <- file.path(getwd())
y.drive.folder <- file.path(base_dir,theme_dir,ind_dir)

# isolate files in Github
list.of.files <- list.files(current_folder, 
                            full.names = T,
                            pattern = "\\.(html|docx)$")
# list.of.files

# copy the files to the new folder
file.copy(list.of.files,
          y.drive.folder,
          overwrite = T)

# keep only .Rmd files in Github (cleaner)
files.in.dir <- list.files(current_folder, 
                            full.names = T)
files.to.keep <- list.files(current_folder, 
                            full.names = T,
                            pattern = "\\.Rmd$")
files.to.remove <- list(files.in.dir[!(files.in.dir %in% grep(paste(files.to.keep, collapse = "|"),
                                                              files.in.dir, value=TRUE))])
do.call(unlink, files.to.remove)
```

## Copy files from Y drive > website folder
```{r to web dev folder, include=FALSE, eval=FALSE}
# set folder structure
current_folder <- file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs')

web.base.folder <- '//WEB/website_data/equity-tracker-webpages'
new.folder <- file.path(web.base.folder,theme_dir)

list.of.files <- list.files(current_folder, 
                            full.names = T)
# list.of.files

# copy the files to the new folder
file.copy(list.of.files,
          new.folder,
          overwrite = T)
```

<a href="#top">Back to top of the page</a>