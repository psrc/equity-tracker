---
title: "Access to Affordable Rent"
subtitle: 'Visuals for Equity Tracker (PUMS data)'
author: "Mary Richards updated by Christy Lam"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  # word_document:
  html_document:
    keep_md: yes
    df_print: paged
    toc: yes
    toc_depth: 6
    toc_float: yes

---

```{r rmarkdown setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, 
                      warning=FALSE, 
                      message=FALSE) # formatting
```

```{r library setup, include=FALSE}
# devtools::install_github("psrc/psrcplot",
#                          force=TRUE)
library(psrcplot)
library(tidyverse)
library(magrittr)

library(sf)
library(leaflet)
library(leafem) #home button
library(htmlwidgets) #save visuals as html

install_psrc_fonts()
library(showtext) #trying to fix PSRC font issues
library(sysfonts) #required for showtext
library(showtextdb) #required for showtext

library(echarts4r)
# remotes::install_github("JohnCoene/echarts4r",
#                         force=TRUE)

library(webshot2) #static image creation
library(here)
```

```{r sources, include=FALSE}

source(here("data-visualization", "addLegend-dec.R"))
source(here("data-visualization", 'equity-tracker-chart-functions.R')) # load visualization functions for charts

```

```{r choose output type}
# output_type <- "word"
output_type <- "html"
```
# 3 visuals for webpage
This code will help produce the three visuals that are going to be a part of each equity tracker indicator webpage: regional map (tract level) of most recent data, chart of the most recent data, chart of trends over time.
\
\
**If the indicator is a PUMS/OPSI indicator that can be accessed through Elmer.** Getting the data to a workable version may require some data transformation. To explore, clean, transform, and generate a final data set, please use the *data-gen-pums-template*. This script will generate an .rda for the map and an .rda for the charts. These data sets will be loaded in before the data visualization code.  

## Indicator Explanation
Access to affordable rent allows people to choose to live in neighborhoods with the communities, services, and amenities that can support their households to thrive. Increasing access to housing provides greater opportunity for all people to choose safe and stable homes to meets their needs.

For this measure, we are focused on renter households and define a census tract as affordable (i.e., having access to affordable rent) if its median gross rent is equal to or less than 30% of the median household income for renters within the region or for a specific group. Across the region or a county, the share of affordable census tracts is calculated to represent the proportion of neighborhoods that is accessible to a typical renter household.

## 1. Map of most recent data
To map data in this form, it requires accessing data at the regional/tract level from ACS since the Elmer data set is already aggregated to equity group/quintile. 

```{r variables setup}
year <- "2022" # most recent year

file_names <- list(base_dir = 'Y:/Equity Indicators/tracker-webpage-content',
                   theme_dir = 'e-housing',
                   ind_dir = 'e01-affordable-rent-access',
                   map = 'e01-affordable-rent-access-map-data.rda',
                   chart = 'e01-affordable-rent-access-chart-data',
                   map_name = 'e01-affordable-rent-access-map.html',
                   chart_column = 'e01-affordable-rent-access-column',
                   chart_line = 'e01-affordable-rent-access-line')
```

### Create Visual
```{r map .rda}
# load map .rda

load(file = file.path(file_names$base_dir,
                      file_names$theme_dir,
                      file_names$ind_dir,
                      "update",
                      "rda-data",
                      file_names$map))
``` 

```{r acs map}
# setting map extent
map.lat<- 47.615
map.lon<- -122.257
map.zoom<- 8.5

# setting color palette
psrc_purple_plus<-c("#FFFFFF", "#FFFFFF", "#F6CEFC", psrc_colors$purples_inc)

psrc_palette <- leaflet::colorFactor(palette = psrc_colors$purples_inc,
                                     domain = acs_data_tract$affordability)

# setting the legend/label variables
var_name <- "Affordability" # the <br> could be adjusted depending on the length/spacing of the name

labels <- sprintf(
  "Census tract: <em>%s</em><br/><strong>%s</strong><br/><body>%s</body><br/><body>%s</body><br/><body>%s</body><br/><body>%s</bodyD>",
  acs_data_tract$geoid20, # the code in <> makes the geoid value bold/italic
  paste("Tract value: ", acs_data_tract$affordability),
  paste("Tract data reliability: ", acs_data_tract$reliability),
  paste("Regional monthly median income: ","$",
        prettyNum((round(acs_data_tract$reg_med_income_monthly, digits=-1)),
                  big.mark = ",")),
  paste("Regional affordability threshold*: ","$",
        prettyNum((round(acs_data_tract$income_30perc, digits=-1)),
                  big.mark = ",")),
  paste("Tract Median Gross Rent: ","$",
        prettyNum((round(acs_data_tract$estimate, digits=-1)),
                  big.mark = ","))) %>%
  lapply(htmltools::HTML)

# map settings
acs_map <- leaflet() %>%
  leaflet::addMapPane(name = "polygons", zIndex = 410) %>%
  leaflet::addMapPane(name = "maplabels", zIndex = 500) %>% # higher zIndex rendered on top
  leaflet::addProviderTiles("CartoDB.VoyagerNoLabels") %>%
  leaflet::addProviderTiles("CartoDB.VoyagerOnlyLabels",
                            options = leaflet::leafletOptions(pane = "maplabels"),
                            group = "Labels") %>%
  addPolygons(data=acs_data_tract,
              # fillColor = psrc_palette(acs_data_plus_zero),
              fillColor = psrc_palette(acs_data_tract$affordability),
              stroke=FALSE, 
              smoothFactor = 0.2,
              fillOpacity = 0.7,
              group = var_name,
              label = labels) %>% 

  # legend
  addLegend_decreasing(pal = psrc_palette,
                       # values = acs_data_plus_zero,
                       values = acs_data_tract$affordability,
                       position = "bottomright",
                       title = var_name,
                       group = var_name,
                       opacity = 0.7,
                       labFormat = labelFormat(),
                       decreasing = FALSE) %>% #to get legend high-low with correct color order
  
  # set view extent
  leaflet::setView(lng=map.lon, lat=map.lat, zoom=map.zoom) %>% 
  addEasyButton(easyButton(
    icon = htmltools::span(class = "globe", htmltools::HTML("&#127758;")),  #&#127760; (another emoji option) #"fa-globe", (font awesome icon no longer works because of the conversion to Poppins font below)  
    title ="Region",
    onClick=JS("function(btn, map){map.setView([47.615,-122.257],8.5); }")))

# fixing the legend NA placement (https://github.com/rstudio/leaflet/issues/615)
css_fix <- "div.info.legend.leaflet-control br {clear: both;} html * {font-family: Poppins !important;}" # CSS to correct spacing and font family
html_fix <- htmltools::tags$style(type = "text/css", css_fix) # Convert CSS to HTML
acs_map %<>% htmlwidgets::prependContent(html_fix) # Insert into leaflet HTML code

# printing map
acs_map
```

Source(s): U.S. Census Bureau, 2018-2022 American Community Survey (ACS) 5-Year Estimates, Table B25064; U.S. Census Bureau, 2018-2022 ACS 5-Year Public Use Microdata Sample; U.S. Census Bureau, Geography Division 2020 TIGER/Line Shapefiles
\
* The regional affordability threshold is defined as 30% of the regional monthly median household income

```{r generate acs map html, include=FALSE}
# to save html visual to folder, you must create an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs

# interactive webpage output process
htmlwidgets::saveWidget(acs_map,
                        file = file.path(file_names$base_dir,
                                         file_names$theme_dir,
                                         file_names$ind_dir,
                                         "update",
                                         'webpage-html-outputs',
                                         file_names$map_name))
```
\
\

#### Data call outs
```{r map calculations - pums, include=FALSE, eval=FALSE}
# simplify data set
data <- acs_data_tract %>%
  st_drop_geometry()

# table(data$affordability) 
# table(data$county_name, data$affordability)

data |> 
  group_by(affordability) |> 
  tally() |> 
  pivot_wider(names_from = affordability, values_from = n) |>
  mutate(denom = (Affordable + `Not affordable`)) |> 
  mutate(share_aff = Affordable / denom) # NA not included in denominator

# 2022 dollars = 383/(383 + 520) = 0.4241417
# 2011 Region = 347/(347+550) = 0.386845

data |> 
  group_by(county_name, affordability) |> 
  tally() |> 
  pivot_wider(names_from = affordability, values_from = n) |>
  mutate(denom = (Affordable + `Not affordable`)) |> 
  mutate(share_aff = Affordable / denom) # NA not included in denominator

# 2022 King: 150/(150+337) = .3080082
# 2022 Kitsap: 37/(37+21) = .6379310
# 2022 Pierce: 124/(124+68) = .6458333
# 2022 Snohomish: 72/(72+94) = .4337349

# 2021 King: 123/(123+362)= 0.2536082
# 2021 Kitsap: 41/(41+18)= 0.6949153
# 2021 Pierce: 114/(114+76)= 0.6
# 2021 Snohomish: 69/(69+94)= 0.4233129

sort <- data %>% 
  dplyr::arrange(desc(estimate))

```

Data callout 1:

42%: Share of tracts in the region where rent is affordable based on the regional median household income

\

#### Insights & Analysis

* Regional affordability threshold for monthly rent, based on 30% of the regional median household income for renters (\$71,91000/year), is \$1,800.
* Access to affordable rent is highest in Pierce (65% of tracts), followed by Kitsap County (64%), Snohomish (43%), and King (31%).
* Ten census tracts tied with the highest median gross rent ($3,500) are all in King County: one is in Seattle (Montlake neighborhood), two are in southern Mercer Island, two are in Clyde Hill/Hunts Point/Medina/Yarrow Point, four are in Bellevue, one is in Auburn (West Hill).
* The highest median gross rent in Kitsap, Pierce, and Snohomish County are in: the southeastern portion of Bainbridge Island (\$2,720), Tehaleh community south of Bonney Lake (\$3,090), and the Edmonds/southern Mukilteo area (\$3,280), respectively. 
* Relatively affordable areas are in south Seattle, south King County, Tacoma/central Pierce County, along the I-5 corridor in Snohomish County and in communities farther out from the region’s urban centers.

\
\


## 2. Facet of most recent data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r data setup, include=FALSE}
# # set folder structure
# rda <- 'e01-affordable-rent-access.rda'

load(file = file.path(file_names$base_dir, 
                      file_names$theme_dir,
                      file_names$ind_dir,
                      "update",
                      "rda-data",
                      file_names$rda_chart))
```

```{r column facet - pums}
# Create Facet Column Chart
data_clean_column <- data_clean %>% 
  filter(data_year == year) #filter on most recent year

# set variables 
df <-  data_clean_column
geo <- "county"
x <- "focus_attribute_ord"
y <- "fact_value"
facet <- "focus_type_ord"
fill <- "focus_attribute_ord"
y_min <- 0
y_max <- 1
dec <- 0
esttype <- "percent"
color <- "oranges"
num_colors <- 2
color_rev <- TRUE
title <- "Access to Affordable Rent by Community"
subtitle <- "Percent of census tracts that are affordable"
source <- "U.S. Census Bureau, 2018-2022 American Community Survey 5-Year Public Use Microdata Sample"

column_chart <- equity_tracker_column_facet(df = df,
                                            geo = geo,
                                            x = x,
                                            y = y,
                                            facet = facet,
                                            title = title,
                                            y_min = y_min,
                                            y_max = y_max,
                                            dec = dec,
                                            esttype = esttype,
                                            color = color,
                                            num_colors = num_colors,
                                            color_rev = color_rev)

# column_chart
```

```{r output final column chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\static-images

# column Chart - html for interactive
rmarkdown::render(here("data-visualization", "equity-tracker-chart-creator.Rmd"),
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                num_colors = num_colors,
                                color_rev = color_rev,
                                title = title,
                                # source = source,
                                subtitle = subtitle),
                  output_file = paste0(file_names$chart_column, '.html'),
                  output_dir = file.path(file_names$base_dir,
                                         file_names$theme_dir,
                                         file_names$ind_dir,
                                         "update",
                                         'webpage-html-outputs'))

# Column Chart - png for use in static file
# need to create a 'static-images' sub-folder in theme sub-folder if not already existing
webshot2::webshot(url = file.path(file_names$base_dir,
                                  file_names$theme_dir,
                                  file_names$ind_dir,
                                  "update", # remove for final output
                                  'webpage-html-outputs', 
                                  paste0(file_names$chart_column, '.html')),
                  file = file.path(file_names$base_dir,
                                   file_names$theme_dir,
                                   file_names$ind_dir, # remove for final output
                                   "update", # remove for final output
                                   'static-images', 
                                   paste0(file_names$chart_column, '.png')),
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r column chart output - pums, echo=FALSE}

if (output_type == "html") {

  column_chart

} else {

  knitr::include_graphics(file.path(file_names$base_dir,
                                    file_names$theme_dir,
                                    file_names$ind_dir, # remove for final output
                                    "update",
                                    'static-images',
                                    paste0(file_names$chart_column, '.png')))

}

# column_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">
`r source`
</p> 

#### Data call outs
```{r column facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information

## Older Cat ----
o_df <- data_clean_column %>% 
  filter(focus_type == "Older_cat")

o_df_wide <- o_df |> 
  select(county, focus_attribute_ord, fact_value_notrounded) |> 
  pivot_wider(id_cols = county,
              names_from = focus_attribute_ord,
              values_from = fact_value_notrounded) |> 
  mutate(diff = abs(`Households with\nolder adults` - `Other households`))

## 2021 Analysis ----
filter <- data_clean_column %>% 
  filter(county == "Region",
         focus_type == "Disability_cat")

# region disability: 0.7562297	(698/923)
# region non-disability: 0.9469122
# 0.9469122-0.7562297=0.1906825

filter <- data_clean_column %>% 
  filter(focus_type == "LEP_cat",
         county == "Region")
# region lep households: 0.02491874	
# region non-lep households: 0.65438787
# 0.65438787-0.02491874=0.6294691

filter <- data_clean_column %>% 
  filter(focus_type == "Older_cat",
         county == "Region")
# region older households: 0.02491874	
# region non-older households: 0.70964247
# 0.70964247-0.02491874=0.1928494

filter <- data_clean_column %>% 
  filter(focus_type == "LEP_cat",
         county == "Snohomish")
# King non-lep-lep households: 0.9494949-0.1151515=	0.8343434
# Kitsap non-lep-lep households: 0.9500000-0.1166667= 0.8333333
# Pierce non-lep-lep households: 0.9689119-0.2279793=	0.7409326
# Snohomish non-lep-lep households: 0.9142857-0.4400000=0.4742857

filter <- data_clean_column %>% 
  filter(focus_type == "Income_cat", 
         vulnerability == "high vulnerability")

filter <- data_clean_column %>% 
  filter(focus_type == "Older_cat",
         county == "King")
# King non-older-older households: 0.76363636-0.01212121=	0.7515152
# Kitsap non-older-older households: 0.6833333-0.1333333=	0.55
# Pierce non-older-older households: 0.6165803-0.1036269=	0.5129534
# Snohomish non-older-older households: 0.54857143-0.01714286=	0.5314286
```


Data callout 2: 

1%: Regionally, 1% of census tracts are affordable to renter households with limited English proficiency, 46X less than the 46% affordable to English-proficient renter households

\

#### Insights & Analysis

* Renters with a disability have access to affordable rent in 3% of the region’s census tracts. 
* There is a 53 percentage point difference in the regional share of affordable tracts between renter households with older adults (1%) and other renter households (54%).
* Renters of color in King County have access to affordable rent in 32% of the census tracts, while white non-Hispanic renters may find 57% of the tracts to be affordable, the largest difference among the counties.
* While the renter affordability gap between people of color and white non-Hispanic people is notable, it is likely even bigger for some racial subgroups (more information about the way in which housing opportunities are different among racial subgroups is available in the Regional Housing Strategy: 2023 Monitoring Report.
* For households living below 200% of poverty level, there is no access to affordable rent.
* The disparity in access to affordable rent between households with older adults and other households is greatest in King County (60%), followed by Kitsap (48%), Pierce (42%), and Snohomish (37%).


\
\


## 3. Facet of trend data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r line facet - pums, include=FALSE}
# Create Facet Line Chart

# set variables
df <-  data_clean
x <- "data_year" # different from variables for facet column
fill <- "focus_attribute_ord" # different from variables for facet column
color <- "blues"
title <- "Access to Affordable Rent Trend by Community"
subtitle <- "Percent of census tracts that are affordable, in 5-year spans between 2011 and 2021"
source <- "U.S. Census Bureau, 2008-2012, 2013-2017, 2018-2022 American Community Survey 5-Year Public Use Microdata Sample"

line_chart <- equity_tracker_line_facet(df = df,
                                        geo = geo,
                                        x = x,
                                        y = y,
                                        fill = fill,
                                        facet = facet,
                                        y_min = y_min,
                                        y_max = y_max,
                                        dec = dec,
                                        esttype = esttype,
                                        color = color,
                                        num_colors = num_colors,
                                        color_rev = color_rev,
                                        width = '420px',
                                        height = '380px')
```

```{r output final line chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\static-images

# Line Chart - html for interactive
rmarkdown::render(here("data-visualization", "equity-tracker-chart-creator.Rmd"),
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                fill = fill,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                num_colors = num_colors,
                                color_rev = color_rev,
                                title = title,
                                # source = source,
                                subtitle = subtitle,
                                width = '420px',
                                height = '380px',
                                charttype = "line"),
                  output_file = paste0(file_names$chart_line, '.html'),
                  output_dir = file.path(file_names$base_dir, 
                                         file_names$theme_dir, 
                                         file_names$ind_dir, 
                                         "update", # remove for final output
                                         'webpage-html-outputs'))

# Line Chart - png for use in static file
webshot2::webshot(url = file.path(file_names$base_dir, 
                                  file_names$theme_dir, 
                                  file_names$ind_dir, 
                                  'webpage-html-outputs', 
                                  paste0(file_names$chart_line, '.html')),
                  file = file.path(file_names$base_dir, 
                                   file_names$theme_dir,  
                                   file_names$ind_dir, # remove for final output
                                   "update", # remove for final output
                                   'static-images', 
                                   paste0(file_names$chart_line, '.png')),
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r line chart - pums, echo=FALSE}

if (output_type == "html") {

  line_chart

} else {

  knitr::include_graphics(file.path(file_names$base_dir,
                                    file_names$theme_dir,
                                    file_names$ind_dir, # remove for final output
                                    "update", # remove for final output
                                    'static-images',
                                    paste0(file_names$chart_line, '.png')))
  
}
# line_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">
`r source`
</p> 

#### Data call outs
```{r line facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean %>%
  filter(county == "Region",
         focus_type == "POC_cat",
         data_year != "2016")
# 2021 poc-2011 poc: 0.4875406-0.7164948=-0.2289542
# # ((0.4875406-0.7164948)/(0.7164948))*100: -31.95476% change
# 2011 nonpoc-2011 nonpoc: 0.6673889-0.8311856=-0.1637967
# # ((0.6673889-0.8311856)/(0.8311856))*100: -19.70639% change

filter <- data_clean %>%
  filter(county == "Region",
         focus_type == "Income_cat",
         data_year != "2016")
# 2021 low income: 0.0000000
# 2021 non-low income: 0.9046587
# 0.9046587-0.0000000=0.9046587
# 2011 low income: 0.0128866
# 2011 non-low income: 0.9716495
# 0.9716495-0.0128866=0.9587629
# ((0.9046587-0.9587629)/(0.9587629))*100: -5.643126% change in gap b/t groups
# ((0.9046587-0.9716495)/(0.9716495))*100: -6.894544% change in gap for non-low income

filter <- data_clean %>%
  filter(county == "Region",
         focus_type == "LEP_cat",
         data_year != "2016")
# 2011 non-lep-lep: 0.83118557-0.17139175=0.6597938
# 2021 non-lep-lep: 0.65438787-0.02491874=0.6294691
# ((0.6294691-0.6597938)/(0.6597938))*100: -4.596087% change
# nonlep 2021-2011: 0.65438787-0.83118557=-0.1767977
# ((0.65438787-0.83118557)/(0.83118557))*100: -21.27054% change in affordable tracts
# lep 2021-2011: 0.02491874-0.17139175=-0.146473
# ((0.02491874-0.17139175)/(0.17139175))*100: -85.46095% change in affordable tracts


filter <- data_clean %>%
  filter(county == "Snohomish",
         focus_type == "Disability_cat",
         data_year != "2011")
# King 2016 non-dis - dis: 0.86934673-0.05276382=0.8165829
# King 2021 non-dis - dis: 0.82020202-0.02424242=0.7959596
# ((0.7959596-0.8165829)/(0.8165829))*100: -2.525561% change
# Kitsap 2016 non-dis - dis: 0.94545455-0.05454545=0.8909091
# Kitsap 2021 non-dis - dis: 0.71666667-0.13333333=0.5833333
# ((0.5833333-0.8909091)/(0.8909091))*100: -34.52381% change
# Pierce 2016 non-dis - dis: 0.7790698-0.1220930=0.6569768
# Pierce 2021 non-dis - dis: 0.6632124-0.2331606=0.4300518
# ((0.4300518-0.6569768)/(0.6569768))*100: -34.54079% change
# Snohomish 2016 non-dis - dis: 0.78807947-0.11920530=0.6688742
# Snohomish 2021 non-dis - dis: 0.57142857-0.05714286=0.5142857
# ((0.5142857-0.6688742)/(0.6688742))*100: -23.11175% change

filter <- data_clean %>%
  filter(county == "King",
         focus_type == "LEP_cat",
         data_year != "2016")
# King 2011 non-lep - lep: 0.85929648-0.18592965=0.6733668
# King 2021 non-lep - lep: 0.73939394-0.01212121=0.7272727
# ((0.7272727-0.6733668)/(0.6733668))*100: 8.005429% change
# Kitsap 2011 non-lep - lep: 0.80000000-0.72727273=0.0727273
# Kitsap 2021 non-lep - lep: 0.58333333-0.01666667=0.5666667
# ((0.5666667-0.0727273)/(0.0727273))*100: 679.1664% change
# Pierce 2011 non-lep - lep: 0.82558140-0.28488372=0.5406977
# Pierce 2021 non-lep - lep: 0.55440415-0.04663212=0.507772
# ((0.507772-0.5406977)/(0.5406977))*100: -6.089484% change
# Snohomish 2011 non-lep - lep: 0.76821192-0.12582781=0.6423841
# Snohomish 2021 non-lep - lep: 0.47428571-0.02285714=0.4514286
# ((0.4514286-0.6423841)/(0.6423841))*100: -29.72606% change

filter <- data_clean %>%
  filter(county == "Snohomish",
         focus_type == "Older_cat",
         vulnerability == "high vulnerability",
         data_year == "2011" |
           data_year == "2021")
# King 2011-2021: 0.19346734-0.01212121=0.1813461
# Kitsap 2011-2021: 0.1272727-0.1333333=-0.0060606
# Pierce 2011-2021: 0.4186047-0.1036269=0.3149778
# Snohomish 2011-2021: 0.07947020-0.01714286=0.06232734
```

Data callout 3: 

2.5X: The share of tracts with affordable rent decreased 45% for renters of color between 2012 and 2022, about 2.5 times more than the decrease for white non-Hispanic renters (38%)

\

#### Insights & Analysis

* The difference in regional access to affordable rent between renter households with lower income and other renter households decreased 12 percentage points because the number of affordable tracts for other renter households decreased by 28. 
* The disparity in access to affordable rent between those with and without a disability decreased over time for most counties, with the greatest difference in Snohomish (41%), followed by Kitsap (33%) and King (14%). The disparity in Pierce grew by 5%.
* The regional share of affordable tracts for renter households with limited English proficiency decreased 86% between 2012 and 2022, a 2.2x larger decrease than for English proficient renter households (-39%).
* The disparity in access to affordable rent between households with limited English proficiency and English proficient households decreased in Snohomish (40 percentage points), followed by King (23 percentage points), and Pierce (18 percentage points), while the disparity greatly increased in Kitsap. 
* Snohomish is the only county where access to affordable rent for households with older adults stayed the same over time, compared to the other counties, where access decreased over time: Pierce (17 percentage points), King (6 percentage points), and Kitsap (4 percentage points).

\
\


# Transfer files
## Copy files from Github > Y drive
```{r to y drive, include=FALSE, eval=FALSE}
# set folder structure
# current_folder <- file.path(getwd()) # maybe use dirname(rstudioapi::getSourceEditorContext()$path)
# y.drive.folder <- file.path(file_names$base_dir, file_names$theme_dir, file_names$ind_dir)
current_folder <- dirname(rstudioapi::getSourceEditorContext()$path)
y.drive.folder <- file.path(file_names$base_dir, file_names$theme_dir, file_names$ind_dir, "update") # to update folder

# isolate files in Github
list.of.files <- list.files(current_folder,
                            full.names = T,
                            pattern = "\\.(html|docx)$")
list.of.files

# # copy the files to the new folder
# file.copy(list.of.files,
#           y.drive.folder,
#           overwrite = T)
# 
# # keep only .Rmd files in Github (cleaner)
# files.in.dir <- list.files(current_folder, 
#                             full.names = T)
# files.to.keep <- list.files(current_folder, 
#                             full.names = T,
#                             pattern = "\\.Rmd$")
# files.to.remove <- list(files.in.dir[!(files.in.dir %in% grep(paste(files.to.keep, collapse = "|"),
#                                                               files.in.dir, value=TRUE))])
# do.call(unlink, files.to.remove)
```

## Copy files from Y drive > website folder
```{r to web dev folder, include=FALSE, eval=FALSE}
# # set folder structure
# current_folder <- file.path(file_names$base_dir, file_names$theme_dir, file_names$ind_dir,'webpage-html-outputs')
# 
# web.base.folder <- '//WEB/website_data/equity-tracker-webpages'
# new.folder <- file.path(web.base.folder, file_names$theme_dir)
# 
# list.of.files <- list.files(current_folder, 
#                             full.names = T)
# # list.of.files
# 
# # copy the files to the new folder
# file.copy(list.of.files,
#           new.folder,
#           overwrite = T)
```

<a href="#top">Back to top of the page</a>