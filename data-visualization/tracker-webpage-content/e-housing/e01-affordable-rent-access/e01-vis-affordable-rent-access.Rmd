---
title: "Access to Affordable Rent"
subtitle: 'Visuals for Equity Tracker (PUMS data)'
author: "Mary Richards"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    keep_md: yes
    df_print: paged
    toc: yes
    toc_depth: 6
    toc_float: yes
  word_document:
---

```{r rmarkdown setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, 
                      warning=FALSE, 
                      message=FALSE) # formatting

# to reference chart functions in Github
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r library setup, include=FALSE}
# devtools::install_github("psrc/psrcplot",
#                          force=TRUE)
library(psrcplot)
library(tidyverse)
library(magrittr)

library(sf)
library(leaflet)
library(leafem) #home button
library(htmlwidgets) #save visuals as html

install_psrc_fonts()
library(showtext) #trying to fix PSRC font issues
library(sysfonts) #required for showtext
library(showtextdb) #required for showtext

library(echarts4r)
# remotes::install_github("JohnCoene/echarts4r",
#                         force=TRUE)

library(webshot2) #static image creation
```

```{r, choose output type}
# output_type <- "word"
output_type <- "html"
```
# 3 visuals for webpage
This code will help produce the three visuals that are going to be a part of each equity tracker indicator webpage: regional map (tract level) of most recent data, chart of the most recent data, chart of trends over time.
\
\
**If the indicator is a PUMS/OPSI indicator that can be accessed through Elmer.** Getting the data to a workable version may require some data transformation. To explore, clean, transform, and generate a final data set, please use the *data-gen-pums-template*. This script will generate an .rda for the map and an .rda for the charts. These data sets will be loaded in before the data visualization code.  

## Indicator Explanation
Access to affordable rent allows people to choose to live in  neighborhoods with the services and amenities that their households require. Increasing access to housing provides greater opportunity for all people to choose safe and stable housing that meets their needs. 

For this measure, we are focused on renting households and define access to affordable rent as the share of census tracts where households can afford to live by spending 30% or less of their income on rent. To determine whether rent is affordable, we compare the median gross rent of the location and the median household income for the region or a specific group of people. At its most basic, we are visualizing where and what proportion of tracts a typical renter can afford the typical rent?

## 1. Map of most recent data
To map data in this form, it requires accessing data at the regional/tract level from ACS since the Elmer data set is already aggregated to equity group/quintile. 
```{r map legend settings, include=FALSE}
# https://stackoverflow.com/questions/40276569/reverse-order-in-r-leaflet-continuous-legend - this code helps to set up the legend so that it is arranged high-low with correct color order
addLegend_decreasing <- function (map, position = c("topright", "bottomright", "bottomleft", 
			    "topleft"), pal, values, na.label = "NA", bins = 7, colors, 
		  opacity = 0.5, labels = NULL, labFormat = labelFormat(), 
		  title = NULL, className = "info legend", layerId = NULL, 
		  group = NULL, data = getMapData(map), decreasing = FALSE) {
	position <- match.arg(position)
	type <- "unknown"
	na.color <- NULL
	extra <- NULL
	if (!missing(pal)) {
		if (!missing(colors)) 
			stop("You must provide either 'pal' or 'colors' (not both)")
		if (missing(title) && inherits(values, "formula")) 
			title <- deparse(values[[2]])
		values <- evalFormula(values, data)
		type <- attr(pal, "colorType", exact = TRUE)
		args <- attr(pal, "colorArgs", exact = TRUE)
		na.color <- args$na.color
		if (!is.null(na.color) && col2rgb(na.color, alpha = TRUE)[[4]] == 
		    0) {
			na.color <- NULL
		}
		if (type != "numeric" && !missing(bins)) 
			warning("'bins' is ignored because the palette type is not numeric")
		if (type == "numeric") {
			cuts <- if (length(bins) == 1) 
				pretty(values, bins)
			else bins	
			
			if (length(bins) > 2) 
				if (!all(abs(diff(bins, differences = 2)) <= 
				         sqrt(.Machine$double.eps))) 
					stop("The vector of breaks 'bins' must be equally spaced")
			n <- length(cuts)
			r <- range(values, na.rm = TRUE)
			cuts <- cuts[cuts >= r[1] & cuts <= r[2]]
			n <- length(cuts)
			p <- (cuts - r[1])/(r[2] - r[1])
			extra <- list(p_1 = p[1], p_n = p[n])
			p <- c("", paste0(100 * p, "%"), "")
			if (decreasing == TRUE){
				colors <- pal(rev(c(r[1], cuts, r[2])))
				labels <- rev(labFormat(type = "numeric", cuts))
			}else{
				colors <- pal(c(r[1], cuts, r[2]))
				labels <- rev(labFormat(type = "numeric", cuts))
			}
			colors <- paste(colors, p, sep = " ", collapse = ", ")
			
		}
		else if (type == "bin") {
			cuts <- args$bins
			n <- length(cuts)
			mids <- (cuts[-1] + cuts[-n])/2
			if (decreasing == TRUE){
				colors <- pal(rev(mids))
				labels <- rev(labFormat(type = "bin", cuts))
			}else{
				colors <- pal(mids)
				labels <- labFormat(type = "bin", cuts)
			}
			
		}
		else if (type == "quantile") {
			p <- args$probs
			n <- length(p)
			cuts <- quantile(values, probs = p, na.rm = TRUE)
			mids <- quantile(values, probs = (p[-1] + p[-n])/2, 
				 na.rm = TRUE)
			if (decreasing == TRUE){
				colors <- pal(rev(mids))
				labels <- rev(labFormat(type = "quantile", cuts, p))
			}else{
				colors <- pal(mids)
				labels <- labFormat(type = "quantile", cuts, p)
			}
		}
		else if (type == "factor") {
			v <- sort(unique(na.omit(values)))
			colors <- pal(v)
			labels <- labFormat(type = "factor", v)
			if (decreasing == TRUE){
				colors <- pal(rev(v))
				labels <- rev(labFormat(type = "factor", v))
			}else{
				colors <- pal(v)
				labels <- labFormat(type = "factor", v)
			}
		}
		else stop("Palette function not supported")
		if (!any(is.na(values))) 
			na.color <- NULL
	}
	else {
		if (length(colors) != length(labels)) 
			stop("'colors' and 'labels' must be of the same length")
	}
	legend <- list(colors = I(unname(colors)), labels = I(unname(labels)), 
	               na_color = na.color, na_label = na.label, opacity = opacity, 
	               position = position, type = type, title = title, extra = extra, 
	               layerId = layerId, className = className, group = group)
	invokeMethod(map, data, "addLegend", legend)
}
```

### Create Visual
```{r map .rda}
# load map .rda
base_dir <- 'Y:/Equity Indicators/tracker-webpage-content'
theme_dir <- 'e-housing'
ind_dir <- 'e01-affordable-rent-access'
rda <- 'e01-affordable-rent-access-map-data.rda'

load(file=file.path(base_dir,theme_dir,ind_dir,"rda-data",rda))
``` 

```{r acs map}
# setting map extent
map.lat<- 47.615
map.lon<- -122.257
map.zoom<- 8.5

# setting color palette
psrc_purple_plus<-c("#FFFFFF", "#FFFFFF", "#F6CEFC", psrc_colors$purples_inc)
# acs_data_plus_zero<-append(acs_data_tract$estimate,0)

# psrc_palette <- leaflet::colorNumeric(palette = psrc_purple_plus,
#                                       domain = acs_data_plus_zero) # this is the value field

# psrc_palette <- leaflet::colorNumeric(palette = psrc_colors$purples_inc,
#                                       domain = acs_data_tract$estimate) # this is the value field
# psrc_palette <- leaflet::colorNumeric(palette = psrc_purple_plus,
#                                       domain = c(min(tract_data_plus_zero,na.rm = TRUE),max_value, NA))
psrc_palette <- leaflet::colorFactor(palette=psrc_colors$purples_inc,
                                      domain = acs_data_tract$affordability)

# setting the legend/label variables
var_name <- "Access to <br> Affordable Rent" # the <br> could be adjusted depending on the length/spacing of the name

# labels <- sprintf(
#   "Census tract: <em>%s</em><br/><strong>%s</strong><br/><body>%s</body><br/><body>%s</body><br/><body>%s</bodyD>",
#   acs_data_tract$geoid20, # the code in <> makes the geoid value bold/italic
#   paste("Tract value: ","$", # if doesn't require prefix, this can be removed
#         prettyNum((round(acs_data_tract$estimate, digits=-1)),
#                   big.mark = ",")),
#   paste("Tract data reliability: ", acs_data_tract$reliability),
#   paste("Region value: ","$",
#         prettyNum((round(acs_data_tract$reg_estimate, digits=-1)),
#                   big.mark = ",")),
#   paste("County value: ","$",
#         prettyNum((round(acs_data_tract$cnty_estimate, digits=-1)),
#                   big.mark = ","), paste0("(",acs_data_tract$county_name," County)"))) %>%
#   lapply(htmltools::HTML)

labels <- sprintf(
  "Census tract: <em>%s</em><br/><strong>%s</strong><br/><body>%s</body><br/><body>%s</body><br/><body>%s</body><br/><body>%s</bodyD>",
  acs_data_tract$geoid20, # the code in <> makes the geoid value bold/italic
  paste("Tract value: ", acs_data_tract$affordability),
  paste("Tract data reliability: ", acs_data_tract$reliability),
  paste("Regional monthly median income: ","$",
        prettyNum((round(acs_data_tract$reg_med_income_monthly, digits=-1)),
                  big.mark = ",")),
  paste("Regional affordability threshold*: ","$",
        prettyNum((round(acs_data_tract$income_30perc, digits=-1)),
                  big.mark = ",")),
  paste("Tract Median Gross Rent: ","$",
        prettyNum((round(acs_data_tract$estimate, digits=-1)),
                  big.mark = ","))) %>%
  lapply(htmltools::HTML)

# map settings
acs_map <- leaflet() %>%
  leaflet::addMapPane(name = "polygons", zIndex = 410) %>%
  leaflet::addMapPane(name = "maplabels", zIndex = 500) %>% # higher zIndex rendered on top
  leaflet::addProviderTiles("CartoDB.VoyagerNoLabels") %>%
  leaflet::addProviderTiles("CartoDB.VoyagerOnlyLabels",
                            options = leaflet::leafletOptions(pane = "maplabels"),
                            group = "Labels") %>%
  addPolygons(data=acs_data_tract,
              # fillColor = psrc_palette(acs_data_plus_zero),
              fillColor = psrc_palette(acs_data_tract$affordability),
              stroke=FALSE, 
              smoothFactor = 0.2,
              fillOpacity = 0.7,
              group = var_name,
              label = labels) %>% 

  # legend
  addLegend_decreasing(pal = psrc_palette,
                       # values = acs_data_plus_zero,
                       values = acs_data_tract$affordability,
                       position = "bottomright",
                       title = var_name,
                       group = var_name,
                       opacity = 0.7,
                       labFormat = labelFormat(),
                       decreasing = FALSE) %>% #to get legend high-low with correct color order
  
  # set view extent
  leaflet::setView(lng=map.lon, lat=map.lat, zoom=map.zoom) %>% 
  addEasyButton(easyButton(
    icon = htmltools::span(class = "globe", htmltools::HTML("&#127758;")),  #&#127760; (another emoji option) #"fa-globe", (font awesome icon no longer works because of the conversion to Poppins font below)  
    title ="Region",
    onClick=JS("function(btn, map){map.setView([47.615,-122.257],8.5); }")))

# fixing the legend NA placement (https://github.com/rstudio/leaflet/issues/615)
css_fix <- "div.info.legend.leaflet-control br {clear: both;} html * {font-family: Poppins !important;}" # CSS to correct spacing and font family
html_fix <- htmltools::tags$style(type = "text/css", css_fix) # Convert CSS to HTML
acs_map %<>% htmlwidgets::prependContent(html_fix) # Insert into leaflet HTML code

# printing map
acs_map
```

Sources: U.S. Census Bureau, American Community Survey (ACS) 2021 5-Year Estimates; U.S. Census Bureau, Geography Division 2020 TIGER/Line Shapefiles
\
* The regional affordability threshold is defined as 30% of the regional monthly median household income

```{r generate acs map html, include=FALSE}
# to save html visual to folder, you must create an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs

# set folder structure
map_name <- 'e01-affordable-rent-access-map.html'

# interactive webpage output process
htmlwidgets::saveWidget(acs_map,
                        file=file.path(base_dir,theme_dir,ind_dir, 'webpage-html-outputs', map_name))
```
\
\

#### Data call outs
```{r map calculations - pums, include=FALSE, eval=FALSE}
# simplify data set
data <- acs_data_tract %>%
  st_drop_geometry()

table(data$affordability)
# 347/(347+550) = 0.386845

table(data$county_name, data$affordability)
# King: 123/(123+362)= 0.2536082
# Kitsap: 41/(41+18)= 0.6949153
# Pierce: 114/(114+76)= 0.6
# Snohomish: 69/(69+94)= 0.4233129

sort <- data %>% 
  dplyr::arrange(desc(estimate))

```

1. \$1,640: Regional affordability threshold, based on the regional median household income for renters ($65,600)
2. 39%: Share of tracts where rent is affordable based on the regional median household income
3. 1/4: King County has the lowest proportion of tracts with affordable rent 

\

#### Insights & Analysis

* Access to affordable rent is highest in Kitsap (69%), followed by Pierce County (60%), Snohomish (42%), and King (25%)
* Ten census tracts tied with the highest median gross rent (\$3,500) are all in King County: three in southern Mercer Island, two in Clyde Hill/Hunts Point/Medina/Yarrow Point, three in Bellevue, two in Sammamish
* The highest median gross rent in Pierce, Kitsap, and Snohomish County are: in Tehaleh community south of Bonney Lake (\$2,800), in the southwestern portion of Bainbridge Island (\$3,500), and southern Mukilteo (\$3,400)
* More affordable rents are seen in south Seattle, south King County, Tacoma/central Pierce County, along the I-5 corridor in Snohomish County, and in communities farther out from the regionâ€™s urban core

\
\


## 2. Facet of most recent data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r data setup, include=FALSE}
# load visualization functions for charts
source('C:/Users/mrichards/Documents/GitHub/equity-tracker/data-visualization/equity-tracker-chart-functions.R') # this needs to be adjusted based on your local GitHub directory - it is required if you wish to run chunks and view the visuals (without first knitting)
source('equity-tracker-chart-functions.R')

# set folder structure
rda <- 'e01-affordable-rent-access.rda'

load(file=file.path(base_dir,theme_dir,ind_dir,"rda-data",rda))
```

```{r column facet - pums}
# Create Facet Column Chart
data_clean_column <- data_clean %>% 
  dplyr::filter(data_year=="2021") #filter on most recent year

# set variables 
df = data_clean_column
geo = "county"
x = "focus_attribute_ord"
y = "fact_value"
facet = "focus_type_ord"
fill = "focus_attribute_ord"
y_min = 0
y_max = 1
dec = 0
esttype = "percent"
color = "purples"
num_colors = 2
color_rev = TRUE
title = "Access to Affordable Rent"
subtitle = "Number of census tracts that are affordable based on median gross rent and median household income"
source = "U.S. Census Bureau, American Community Survey (ACS) 2021 5-Year Estimates; U.S. Census Bureau, Geography Division 2020 TIGER/Line Shapefiles"

column_chart <- equity_tracker_column_facet(df = df,
                                            geo = geo,
                                            x = x,
                                            y = y,
                                            facet = facet,
                                            title = title,
                                            y_min = y_min,
                                            y_max = y_max,
                                            dec = dec,
                                            esttype = esttype,
                                            color = color,
                                            num_colors = num_colors,
                                            color_rev = color_rev)
```

```{r output final column chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\static-images

# set folder structure
file_name <- 'e01-affordable-rent-access-column'

# column Chart - html for interactive
rmarkdown::render("equity-tracker-chart-creator.RMD",
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                num_colors = num_colors,
                                color_rev = color_rev,
                                title = title,
                                source = source,
                                subtitle = subtitle),
                  output_file = paste0(file_name, '.html'),
                  output_dir = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs'))

# Column Chart - png for use in static file
# need to create a 'static-images' sub-folder in theme sub-folder if not already existing
webshot2::webshot(url = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs', paste0(file_name, '.html')), 
                  file = file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')), 
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r column chart output - pums, echo=FALSE}

if (output_type == "html") {

  column_chart  
  
} else {
  
  knitr::include_graphics(file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')))
  
}

# column_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">
`r source`
</p> 

#### Data call outs
```{r column facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean_column %>% 
  filter(county=="Region",
         focus_type=="Disability_cat")

# region disability: 0.7562297	(698/923)
# region non-disability: 0.9469122
# 0.9469122-0.7562297=0.1906825

filter <- data_clean_column %>% 
  filter(focus_type=="LEP_cat",
         county=="Region")
# region lep households: 0.2340195	
# region non-lep households: 0.9404117
# 0.9404117-0.2340195=0.7063922

filter <- data_clean_column %>% 
  filter(focus_type=="Older_cat",
         county=="Region")
# region older households: 0.7573131	
# region non-older households: 0.9501625
# 0.9501625-0.7573131=0.1928494

filter <- data_clean_column %>% 
  filter(focus_type=="LEP_cat",
         county=="Snohomish")
# King non-lep-lep households: 0.9494949-0.1151515=	0.8343434
# Kitsap non-lep-lep households: 0.9500000-0.1166667= 0.8333333
# Pierce non-lep-lep households: 0.9689119-0.2279793=	0.7409326
# Snohomish non-lep-lep households: 0.9142857-0.4400000=0.4742857


filter <- data_clean_column %>% 
  filter(focus_type=="Income_cat", 
         vulnerability == "high vulnerability")

filter <- data_clean_column %>% 
  filter(focus_type=="Older_cat",
         county=="Snohomish")
# King non-older-older households: 0.9575758-0.7474747=	0.2101011
# Kitsap non-older-older households: 0.95-0.90=	0.05
# Pierce non-older-older households: 0.9740933-0.8963731=	0.0777202
# Snohomish non-older-older households: 0.9200000-0.7028571=	0.2171429
```

1. 3/4: Three out of every four census tracts in the region are affordable for people with a disability
2. 23%: Share of affordable tracts for households with limited English proficiency, a 71 percentage point difference compared to English-proficient households
3. 19%: Difference in the share of affordable tracts between households with older adults and other households

\

#### Insights & Analysis

* People of color have slightly lower access to affordable rent in all counties compared to white non-Hispanic, except in Snohomish County where both groups are able to afford rent in 91% of the census tracts
* This small difference between the people of color and white non-Hispanic groups is in part driven by the high median household incomes for certain Asian households. More information about the way in which the Asian subgroup differs in housing opportunities from other racial subgroups is available in the [Regional Housing Strategy: 2023 Monitoring Report](https://www.psrc.org/media/8253). Within the Asian racial group, there is also great diversity and disparities experienced by different Asian subgroups, as described in a [PSRC blog post](https://www.psrc.org/about-us/media-hub/diversity-asian-and-pacific-islander-experiences) from 2022
* For households living below 200% of poverty level, Pierce County is the only county where there is one affordable tract (out of 193, or 1%)
* The disparity in access to affordable rent between households with older adults and other households is greatest in Snohomish County (22%) and King (21%), and much smaller in Pierce (8%) and Kitsap (5%)

\
\


## 3. Facet of trend data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r line facet - pums, include=FALSE}
# Create Facet Line Chart

# set variables
df = data_clean
x = "data_year" # different from variables for facet column
fill = "focus_attribute_ord" # different from variables for facet column
color = "purples"

line_chart <- equity_tracker_line_facet(df = df,
                                        geo = geo,
                                        x = x,
                                        y = y,
                                        fill = fill,
                                        facet = facet,
                                        y_min = y_min,
                                        y_max = y_max,
                                        dec = dec,
                                        esttype = esttype,
                                        color = color,
                                        num_colors = num_colors,
                                        color_rev = color_rev,
                                        width = '420px',
                                        height = '380px')
```

```{r output final line chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\static-images

# set folder structure
file_name <- 'e01-affordable-rent-access-line'

# Line Chart - html for interactive
rmarkdown::render("equity-tracker-chart-creator.RMD",
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                fill = fill,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                num_colors = num_colors,
                                color_rev = color_rev,
                                title = title,
                                source = source,
                                subtitle = subtitle,
                                width = '420px',
                                height = '380px',
                                charttype = "line"),
                  output_file = paste0(file_name, '.html'),
                  output_dir = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs'))

# Line Chart - png for use in static file
webshot2::webshot(url = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs', paste0(file_name, '.html')), 
                  file = file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')), 
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r line chart - pums, echo=FALSE}
if (output_type == "html") {

  line_chart  
  
} else {
  
  knitr::include_graphics(file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')))
  
}
# line_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">
`r source`
</p> 

#### Data call outs
```{r line facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="Income_cat",
         data_year!="2016")
# 2021 low income: 0.001083424
# 2021 non-low income: 0.956663055
# 0.956663055-0.001083424=0.9555796
# 2011 low income: 0.011597938
# 2011 non-low income: 0.992268041
# 0.992268041-0.011597938=0.9806701
# ((0.9555796-0.9806701)/(0.9806701))*100: -2.558506% change
# low income: 0.011597938-0.001083424=0.01051451
# non-low income: 0.992268041-0.956663055=0.03560499


filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="POC_cat",
         data_year!="2016")
# 2011 non-poc-poc: 0.9922680-0.9626289=0.0296391
# 2021: 0.9404117-0.9122427=0.028169

filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="LEP_cat",
         data_year!="2016")
# 2011 non-lep-lep: 0.9922680-0.6456186=0.3466494
# 2021 non-lep-lep: 0.9404117-0.2340195=0.7063922
# ((0.7063922-0.3466494)/(0.3466494))*100: 103.7771% change


filter <- data_clean %>%
  filter(county=="Snohomish",
         focus_type=="Disability_cat",
         data_year=="2021")
# Region 2016 non-dis - dis: 0.9664948-0.7835052=0.1829896
# Region 2021 non-dis - dis: 0.9469122-0.7562297=0.1906825
# ((0.1906825-0.1829896)/(0.1829896))*100: 4.204009% change
# King 2016 non-dis - dis: 0.9648241-0.7361809=0.2286432
# King 2021 non-dis - dis: 0.9555556-0.6585859=0.2969697
# ((0.2969697-0.2286432)/(0.2286432))*100: 29.88346% change
# Kitsap 2016 non-dis - dis: 0.9818182-0.9636364=0.0181818
# Kitsap 2021 non-dis - dis: 0.95-0.90=0.05
# ((0.05-0.0181818)/(0.0181818))*100: 175.0003% change
# Pierce 2016 non-dis - dis: 0.9883721-0.8430233=0.1453488
# Pierce 2021 non-dis - dis: 0.9740933-0.9170984=0.0569949
# ((0.0569949-0.1453488)/(0.1453488))*100: -60.7875% change
# Snohomish 2016 non-dis - dis: 0.9602649-0.7682119=0.192053
# Snohomish 2021 non-dis - dis: 0.9142857-0.7828571=0.1314286
# ((0.1314286-0.192053)/(0.192053))*100: -31.56649% change

filter <- data_clean %>%
  filter(county=="Snohomish",
         focus_type=="LEP_cat",
         data_year=="2011")
# King 2011 non-lep - lep: 0.9924623-0.5728643=0.419598
# King 2021 non-lep - lep: 0.9494949-0.1151515=0.8343434
# ((0.8343434-0.419598)/(0.419598))*100: 98.84351% change
# Kitsap 2011 non-lep - lep: 0.9818182-0.7636364=0.2181822
# Kitsap 2021 non-lep - lep: 0.9500000-0.1166667=0.8333333
# ((0.8333333-0.2181822)/(0.2181822))*100: 281.9438% change
# Pierce 2011 non-lep - lep: 1.0000000-0.7093023=0.2906977
# Pierce 2021 non-lep - lep: 0.9689119-0.2279793=0.7409326
# ((0.7409326-0.2906977)/(0.2906977))*100: 154.8808% change
# Snohomish 2011 non-lep - lep: 0.9735099-0.6026490=0.3708609
# Snohomish 2021 non-lep - lep: 0.9142857-0.4400000=0.4742857
# ((0.4742857-0.3708609)/(0.3708609))*100: 27.88776% change

filter <- data_clean %>%
  filter(county=="Snohomish",
         focus_type=="Older_cat",
         vulnerability=="high vulnerability",
         data_year=="2011" |
           data_year=="2021")
# King 2011-2021: 0.8592965-0.7474747=0.1118218
# Kitsap 2011-2021: 0.9090909-0.9000000=0.0090909
# Pierce 2011-2021: 0.9186047-0.8963731=0.0222316
# Snohomish 2011-2021: 0.8675497-0.7028571=0.1646926
```

1. 3%: The share of tracts with affordable rent decreased 3% for both people of color and white non-Hispanic individuals between 2011 and 2021
2. 1%: Regional access to affordable rent decreased 1% for households in the region living below 200% of federal poverty between 2011 and 2021, from 9 census tracts to 1
3. 2x: The disparity in access to affordable rent between households with limited English proficiency and English proficient households doubled (increased 104%) between 2011 and 2021


\

#### Insights & Analysis
* Although the disparity in access to affordable rent between those with and without a disability appears to have remained relatively consistent over time at the regional level, it increased in King (30%) and Kitsap (175%) counties, while decreasing in Pierce (-61%) and Snohomish (-32%)
* The disparity between households with limited English proficiency and English proficient households increased over time in all counties, with the largest increase in Kitsap (288%), followed by Pierce (155%), King (99%), and Snohomish (28%)
* Access to affordable rent decreased over time for households with older adults, especially in Snohomish (16%) and King (11%) and counties. The decreases in Pierce (2%) and Kitsap (1%) were much smaller 


\
\


# Transfer files
## Copy files from Github > Y drive
```{r to y drive, include=FALSE, eval=FALSE}
# set folder structure
current_folder <- file.path(getwd())
y.drive.folder <- file.path(base_dir,theme_dir,ind_dir)

# isolate files in Github
list.of.files <- list.files(current_folder, 
                            full.names = T,
                            pattern = "\\.(html|docx)$")
# list.of.files

# copy the files to the new folder
file.copy(list.of.files,
          y.drive.folder,
          overwrite = T)

# keep only .Rmd files in Github (cleaner)
files.in.dir <- list.files(current_folder, 
                            full.names = T)
files.to.keep <- list.files(current_folder, 
                            full.names = T,
                            pattern = "\\.Rmd$")
files.to.remove <- list(files.in.dir[!(files.in.dir %in% grep(paste(files.to.keep, collapse = "|"),
                                                              files.in.dir, value=TRUE))])
do.call(unlink, files.to.remove)
```

## Copy files from Y drive > website folder
```{r to web dev folder, include=FALSE, eval=FALSE}
# set folder structure
current_folder <- file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs')

web.base.folder <- '//WEB/website_data/equity-tracker-webpages'
new.folder <- file.path(web.base.folder,theme_dir)

list.of.files <- list.files(current_folder, 
                            full.names = T)
# list.of.files

# copy the files to the new folder
file.copy(list.of.files,
          new.folder,
          overwrite = T)
```

<a href="#top">Back to top of the page</a>