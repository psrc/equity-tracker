---
title: "Overcrowding"
subtitle: "Visuals for Equity Tracker (PUMS data)"
author: "Meg Grzybowski"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  word_document:
  html_document:
    keep_md: yes
    df_print: paged
    toc: yes
    toc_depth: 6
    toc_float: yes
---

```{r rmarkdown setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, 
                      warning=FALSE, 
                      message=FALSE) # formatting

# to reference chart functions in Github
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r library setup, include=FALSE}
# devtools::install_github("psrc/psrcplot",
#                          force=TRUE)
library(psrcplot)
library(tidyverse)
library(magrittr)

library(sf)
library(leaflet)
library(leafem) #home button
library(htmlwidgets) #save visuals as html

install_psrc_fonts()
library(showtext) #trying to fix PSRC font issues
library(sysfonts) #required for showtext
library(showtextdb) #required for showtext

library(echarts4r)
# remotes::install_github("JohnCoene/echarts4r",
#                         force=TRUE)

library(webshot2) #static image creation
```

```{r, choose output type}
#output_type <- "word"
output_type <- "html"
```
# 3 visuals for webpage
This code will help produce the three visuals that are going to be a part of each equity tracker indicator webpage: regional map (tract level) of most recent data, chart of the most recent data, chart of trends over time.
\
\
**If the indicator is a PUMS/OPSI indicator that can be accessed through Elmer.** Getting the data to a workable version may require some data transformation. To explore, clean, transform, and generate a final data set, please use the *data-gen-pums-template*. This script will generate an .rda for the map and an .rda for the charts. These data sets will be loaded in before the data visualization code.  

## 1. Map of most recent data
To map data in this form, it requires accessing data at the regional/tract level from ACS since the Elmer data set is already aggregated to equity group/quintile. 
```{r map legend settings, include=FALSE}
# https://stackoverflow.com/questions/40276569/reverse-order-in-r-leaflet-continuous-legend - this code helps to set up the legend so that it is arranged high-low with correct color order
addLegend_decreasing <- function (map, position = c("topright", "bottomright", "bottomleft", 
			    "topleft"), pal, values, na.label = "NA", bins = 9, colors, 
		  opacity = 0.5, labels = NULL, labFormat = labelFormat(), 
		  title = NULL, className = "info legend", layerId = NULL, 
		  group = NULL, data = getMapData(map), decreasing = FALSE) {
	position <- match.arg(position)
	type <- "unknown"
	na.color <- NULL
	extra <- NULL
	if (!missing(pal)) {
		if (!missing(colors)) 
			stop("You must provide either 'pal' or 'colors' (not both)")
		if (missing(title) && inherits(values, "formula")) 
			title <- deparse(values[[2]])
		values <- evalFormula(values, data)
		type <- attr(pal, "colorType", exact = TRUE)
		args <- attr(pal, "colorArgs", exact = TRUE)
		na.color <- args$na.color
		if (!is.null(na.color) && col2rgb(na.color, alpha = TRUE)[[4]] == 
		    0) {
			na.color <- NULL
		}
		if (type != "numeric" && !missing(bins)) 
			warning("'bins' is ignored because the palette type is not numeric")
		if (type == "numeric") {
			cuts <- if (length(bins) == 1) 
				pretty(values, bins)
			else bins	
			
			if (length(bins) > 2) 
				if (!all(abs(diff(bins, differences = 2)) <= 
				         sqrt(.Machine$double.eps))) 
					stop("The vector of breaks 'bins' must be equally spaced")
			n <- length(cuts)
			r <- range(values, na.rm = TRUE)
			cuts <- cuts[cuts >= r[1] & cuts <= r[2]]
			n <- length(cuts)
			p <- (cuts - r[1])/(r[2] - r[1])
			extra <- list(p_1 = p[1], p_n = p[n])
			p <- c("", paste0(100 * p, "%"), "")
			if (decreasing == TRUE){
				colors <- pal(rev(c(r[1], cuts, r[2])))
				labels <- rev(labFormat(type = "numeric", cuts))
			}else{
				colors <- pal(c(r[1], cuts, r[2]))
				labels <- rev(labFormat(type = "numeric", cuts))
			}
			colors <- paste(colors, p, sep = " ", collapse = ", ")
			
		}
		else if (type == "bin") {
			cuts <- args$bins
			n <- length(cuts)
			mids <- (cuts[-1] + cuts[-n])/2
			if (decreasing == TRUE){
				colors <- pal(rev(mids))
				labels <- rev(labFormat(type = "bin", cuts))
			}else{
				colors <- pal(mids)
				labels <- labFormat(type = "bin", cuts)
			}
			
		}
		else if (type == "quantile") {
			p <- args$probs
			n <- length(p)
			cuts <- quantile(values, probs = p, na.rm = TRUE)
			mids <- quantile(values, probs = (p[-1] + p[-n])/2, 
				 na.rm = TRUE)
			if (decreasing == TRUE){
				colors <- pal(rev(mids))
				labels <- rev(labFormat(type = "quantile", cuts, p))
			}else{
				colors <- pal(mids)
				labels <- labFormat(type = "quantile", cuts, p)
			}
		}
		else if (type == "factor") {
			v <- sort(unique(na.omit(values)))
			colors <- pal(v)
			labels <- labFormat(type = "factor", v)
			if (decreasing == TRUE){
				colors <- pal(rev(v))
				labels <- rev(labFormat(type = "factor", v))
			}else{
				colors <- pal(v)
				labels <- labFormat(type = "factor", v)
			}
		}
		else stop("Palette function not supported")
		if (!any(is.na(values))) 
			na.color <- NULL
	}
	else {
		if (length(colors) != length(labels)) 
			stop("'colors' and 'labels' must be of the same length")
	}
	legend <- list(colors = I(unname(colors)), labels = I(unname(labels)), 
	               na_color = na.color, na_label = na.label, opacity = opacity, 
	               position = position, type = type, title = title, extra = extra, 
	               layerId = layerId, className = className, group = group)
	invokeMethod(map, data, "addLegend", legend)
}
```

### Create Visual
```{r map .rda}
# load map .rda

base_dir <- 'Y:/Equity Indicators/tracker-webpage-content'
theme_dir <- 'e-housing'
ind_dir <- 'e04-overcrowding'
rda <- 'e04-overcrowding-map-data.rda'

load(file=file.path(base_dir,theme_dir,ind_dir,"rda-data",rda))
``` 

```{r acs map}
# setting map extent
map.lat<- 47.615
map.lon<- -122.257
map.zoom<- 8.5

# setting color palette
psrc_palette <- leaflet::colorNumeric(palette = psrc_colors$purples_inc,
                                      domain = acs_data_tract$estimate) # this is the value field

# setting the legend/label variables
var_name <- "Overcrowding: <br> Percentage of Households <br> with >1.5 persons <br> per Bedroom" # the <br> could be adjusted depending on the length/spacing of the name
#labels <- sprintf(
 # "Census tract: <em>%s</em><br/><strong>%s</strong>", acs_data_tract$geoid20, # the code in <> makes the geoid value italic
  #paste("$", # if doesn't require prefix, this can be removed
   #     prettyNum((round(acs_data_tract$estimate, digits=-2)),
    #              big.mark = ","))) %>%
  #lapply(htmltools::HTML)

# if the label required a suffix instead of a prefix, for example a %, the code would look like this:
labels <- sprintf(
   "Census tract: <em>%s</em><br/><strong>%s</strong>", acs_data_tract$geoid20,
   paste(prettyNum((round(acs_data_tract$estimate, digits=0)), #the digits would probably be 2 for %
               big.mark = ","), #this wouldn't be necessary to include for %s    
         '%')) %>%
   lapply(htmltools::HTML)


# map settings
acs_map <- leaflet() %>%
  leaflet::addMapPane(name = "polygons", zIndex = 410) %>%
  leaflet::addMapPane(name = "maplabels", zIndex = 500) %>% # higher zIndex rendered on top
  leaflet::addProviderTiles("CartoDB.VoyagerNoLabels") %>%
  leaflet::addProviderTiles("CartoDB.VoyagerOnlyLabels",
                            options = leaflet::leafletOptions(pane = "maplabels"),
                            group = "Labels") %>%
  addPolygons(data=acs_data_tract,
              fillColor = psrc_palette(acs_data_tract$estimate),
              stroke=FALSE, 
              smoothFactor = 0.2,
              fillOpacity = 0.7,
              group = var_name,
              label = labels) %>% 

  # legend
  addLegend_decreasing(pal = psrc_palette,
                       values = acs_data_tract$estimate,
                       position = "bottomright",
                       title = var_name,
                       group = var_name,
                       opacity = 0.7,
                       labFormat = labelFormat(suffix = "%"),
                       decreasing = TRUE) %>% #to get legend high-low with correct color order
  
  # set view extent
  leaflet::setView(lng=map.lon, lat=map.lat, zoom=map.zoom) %>% 
  addEasyButton(easyButton(
    icon = htmltools::span(class = "globe", htmltools::HTML("&#127758;")),  #&#127760; (another emoji option) #"fa-globe", (font awesome icon no longer works because of the conversion to Poppins font below)  
    title ="Region",
    onClick=JS("function(btn, map){map.setView([47.615,-122.257],8.5); }")))

# fixing the legend NA placement (https://github.com/rstudio/leaflet/issues/615)
css_fix <- "div.info.legend.leaflet-control br {clear: both;} html * {font-family: Poppins !important;}" # CSS to correct spacing and font family
html_fix <- htmltools::tags$style(type = "text/css", css_fix) # Convert CSS to HTML
acs_map %<>% htmlwidgets::prependContent(html_fix) # Insert into leaflet HTML code

# printing map
acs_map
```

```{r generate acs map html, include=FALSE}
# to save html visual to folder, you must create an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs

# set folder structure
map_name <- 'e04-overcrowding-map.html'
  
# interactive webpage output process
htmlwidgets::saveWidget(acs_map,
                        file=file.path(base_dir,theme_dir,ind_dir, 'webpage-html-outputs', map_name))
```
\
\

#### Data call outs
```{r map calculations - pums, include=FALSE, eval=FALSE}
# simplify data set
data <- acs_data_tract %>%
  st_drop_geometry()

x<-rep(data$estimate,times=data$total_pop20)
df1<-data.frame(x)
summary(df1$x)
median(df1$x, na.rm=TRUE)
hist(df1$x)
# regional median life expectancy: 80.86 

# getting data by region from PUMS
#pums_data <- get_psrc_pums(span = 5,
 #                          dyear = 2021,
  #                         level = "h",
   #                        vars = "HINCP")
#reg_median <- psrc_pums_median(pums_data, stat_var = "HINCP")
# regional median income: 96453.13

sort <- data %>% 
  dplyr::arrange(desc(estimate))
# 53033005303 (University District), 53033011801 (Dunlap), 53035081400 (Kitsap - Port of Bremerton), 53053073132 (Pierce - South of South Hill), 53033007503 (NE of First Hill Neighborhood)

# this calculation doesn't work for median income because median is unique - need to retrieve from census 
#by_county <- data %>% 
 #  dplyr::group_by(county_name) %>% 
  # dplyr::summarise(income.wgt=(sum(estimate*total_pop20, na.rm =TRUE))/(sum(total_pop20, na.rm=TRUE))) %>% 
   #dplyr::arrange(desc(income.wgt))

# getting data by county from acs 
county_acs_data <- get_acs_recs(geography ='county', 
                                table.names = 'B25014', #subject table code
                                years = c(2021),
                                acs.type = 'acs5')

# cleaning data to include total percentage of owner-occupied units
row_names <- c('B25014_002', 'B25014_003', 'B25014_004', 'B25014_005', 'B25014_006', 'B25014_007', 'B25014_008', 'B25014_009', 'B25014_010', 
               'B25014_011', 'B25014_012', 'B25014_013')

variable <- "Less than or equal to 1.5 persons per bedroom"

county_acs_data <- county_acs_data %>% rename_at('label', ~'per_bedroom')%>%
  rename_at ('variable', ~ 'type')

county_acs_data <- county_acs_data %>%
  dplyr::filter(type %in% row_names) %>%
  mutate(per_bedroom = factor(
    case_when(per_bedroom == "Estimate!!Total:!!Owner occupied:" ~ "Total",
              per_bedroom == "Estimate!!Total:!!Renter occupied:" ~ "Total",
                                   TRUE ~ as.character(per_bedroom)))) %>%
  mutate(per_bedroom = factor(
             case_when(grepl("0.50 or less|0.51 to 1.00|1.01 to 1.50", per_bedroom) ~ "Less than or equal to 1.5 persons per bedroom",
                       grepl("1.51 to 2.00|2.01 or more", per_bedroom) ~ "Overcrowding",
                       TRUE ~ as.character(per_bedroom)))) %>%
  mutate(type = factor(
    case_when(grepl("B25014_002|B25014_003|B25014_004|B25014_005|B25014_006|B25014_007", type) ~ "Owner",
              grepl("B25014_008|B25014_009|B25014_010|B25014_011|B25014_012|B25014_013", type) ~ "Renter",
              TRUE ~ as.character(per_bedroom))))%>%
  dplyr::filter(type != 'Owner')    #this can be commented out for inclusion of both Owners and Renters

# group similar rows
county_acs_data <- county_acs_data %>% 
  dplyr::group_by(GEOID, name, per_bedroom)%>%
  dplyr::summarise(estimate=sum(estimate), .groups = 'drop')%>%
  filter(per_bedroom != variable)

# pivot data to calculate percentage by census tract
county_acs_data <- county_acs_data %>% 
  pivot_wider(names_from = per_bedroom, values_from = estimate)

county_acs_data$estimate <- ((county_acs_data$Overcrowding/county_acs_data$Total)*100)

# King (3.5), REGION (2.9), Snohomish (2.3), Pierce (2.1), Kitsap (1.2)
```

1. King: The only county with higher overcrowding rates than the regional average
2. 50%: The region's highest percentage of households living with >1.5 person(s) per bedroom
3. 2.3%: Average percentage of households in a census tract that are living in an overcrowded home

\

#### Insights & Analysis

* King County has the highest rates of overcrowding (3.5%), followed by Snohomish (2.3%), Pierce (2.1%), and Kitsap (1.2%)
* The five census tracts tied with the highest rates of overcrowding are in King County: U District (50%), Dunlap (35%), and NE of the First Hill Neighborhood (24%), along with the Port of Bremerton in Kitsap (31%) and South Hill in Pierce County (29%)
* Over half of the census tracts in the region are not experiencing overcrowding (500 out of 919 tracts)

\
\


## 2. Facet of most recent data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r data setup, include=FALSE}
# load visualization functions for charts
source('C:/Coding/CURRENT_REPOS_GITHUB/equity-tracker/data-visualization/equity-tracker-chart-functions.R')
#source('equity-tracker-chart-functions.R')

# set folder structure
rda <- 'e04-overcrowding-data.rda'

load(file=file.path(base_dir,theme_dir,ind_dir,"rda-data",rda))
```

```{r column facet - pums}
# Create Facet Column Chart
data_clean_column <- data_clean %>% 
  dplyr::filter(data_year=="2021")%>% #filter on most recent year
  dplyr::filter(indicator_attribute=="More than 1.5 persons per bedroom")

# set variables 
df = data_clean_column
geo = "county"
x = "focus_attribute_ord"
y = "fact_value"
facet = "focus_type_ord"
fill = "focus_attribute_ord"
y_min = 0
y_max = 0.5
dec = 0
esttype = "percent"
color = "purples"
title = "Overcrowding"
subtitle = "More than 1.5 person(s) per bedroom"
source = "U.S. Census Bureau, American Community Survey (ACS) 5-Year Public Use Microdata Sample (PUMS)"

column_chart <- equity_tracker_column_facet(df = df,
                                            geo = geo,
                                            x = x,
                                            y = y,
                                            facet = facet,
                                            title = title,
                                            y_min = y_min,
                                            y_max = y_max,
                                            dec = dec,
                                            esttype = esttype,
                                            color = color)

```

```{r output final column chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\static-images

# set folder structure
file_name <- 'e04-overcrowding-column'

# column Chart - html for interactive
rmarkdown::render("C:/Coding/CURRENT_REPOS_GITHUB/equity-tracker/data-visualization/equity-tracker-chart-creator.RMD", 
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                title = title,
                                source = source,
                                subtitle = subtitle),
                  output_file = paste0(file_name, '.html'),
                  output_dir = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs'))

# Column Chart - png for use in static file
# need to create a 'static-images' sub-folder in theme sub-folder if not already existing
webshot2::webshot(url = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs', paste0(file_name, '.html')), 
                  file = file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')), 
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r column chart output - pums, echo=FALSE}

if (output_type == "html") {

  column_chart  
  
} else {
  
  knitr::include_graphics(file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')))
  
}

column_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">
`r source`
</p> 

#### Data call outs
```{r column facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean_column %>% 
  filter(county=="Region",
         focus_type=="Income_cat")

# region low income households: 20% vs 10% - double

filter <- data_clean_column %>% 
  filter(focus_type=="LEP_cat",
         county=="Region")
# region lep households: 58284.83	
# region non-lep households: 116673.43
# 116673.43-58284.83=58388.6

filter <- data_clean_column %>% 
  filter(focus_type=="LEP_cat",
         vulnerability=="high vulnerability")

# region lep households: 58284.83	
# snohomish lep households: 67832.94
# 71.45515-63.50990=7.94525

filter <- data_clean_column %>% 
  filter(county=="Region",
         focus_type=="Youth_cat")

# region youth households: 141389.8	
# region non-youth households: 102097.0
# 141389.8-102097.0=39292.8

filter <- data_clean_column %>% 
  filter(focus_type=="POC_cat")
# snohomish poc: 108886.4
# snohomish non-poc: 112974.4
# 112974.4-108886.4=4088

# king poc: 111529.77
# king non-poc: 130977.15
# 130977.15-111529.77=19447.38

filter <- data_clean_column %>% 
  filter(focus_type=="Youth_cat")
# kitsap dis: 84171.34
# kitsap non-dis: 104284.10
# 104284.10-84171.34=20112.76

# king dis: 81508.16
# king non-dis: 134637.12
# 134637.12-81508.16=53128.96

filter <- data_clean_column %>% 
  filter(focus_type=="Income_cat",
         vulnerability=="high vulnerability") %>% 
  dplyr::arrange(desc(fact_value))

```

1. 19%: The regional level of overcrowding for people of color, 10 percentage points higher than white non-Hispanic households
2. 24%: Percentage of non-Enlgish proficient households experiencing overcrowding, 13 percentage points higher than than English proficient households
3. 16%: Households with children (below 18 years old) are 16 percentage points higher than households without children

\

#### Insights & Analysis

* The largest difference in overcrowding rates between people of color and white non-Hispanic is in Snohomish and King County (11 percentage points), while the smallest difference is in Pierce County (7 percentage points)
* The largest difference in households experiencing overcrowding between people with and without a disability is in Pierce and Snohomish County (only 2 percentage points), while the rest of the counties show no disparities
* Households with children (below 18 years old) and households with non-English proficient speakers have the highest rates of overcrowding across all of the equity indicators, regardless of county (21-25%). However, there are the largest disparities between households with youth and without youth (up to 16 percentage point difference)

\
\


## 3. Facet of trend data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r line facet - pums, include=FALSE}
# Create Facet Line Chart

data_clean <- data_clean %>% 
  dplyr::filter(indicator_attribute=="More than 1.5 persons per bedroom")

# set variables
df = data_clean
x = "data_year" # different from variables for facet column
fill = "focus_attribute_ord" # different from variables for facet column
color = "purples"

line_chart <- equity_tracker_line_facet(df = df,
                                        geo = geo,
                                        x = x,
                                        y = y,
                                        fill = fill,
                                        facet = facet,
                                        y_min = y_min,
                                        y_max = y_max,
                                        dec = dec,
                                        esttype = esttype,
                                        color = color,
                                        width = '420px',
                                        height = '380px')
```

```{r output final line chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\f01-median-income\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\f-economy\static-images

# set folder structure
file_name <- 'e04-overcrowding-line'

# Line Chart - html for interactive
rmarkdown::render("C:/Coding/CURRENT_REPOS_GITHUB/equity-tracker/data-visualization/equity-tracker-chart-creator.RMD", 
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                fill = fill,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                title = title,
                                source = source,
                                subtitle = subtitle,
                                width = '420px',
                                height = '380px',
                                charttype = "line"),
                  output_file = paste0(file_name, '.html'),
                  output_dir = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs'))

# Line Chart - png for use in static file
webshot2::webshot(url = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs', paste0(file_name, '.html')), 
                  file = file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')), 
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r line chart - pums, echo=FALSE}
if (output_type == "html") {

  line_chart  
  
} else {
  
  knitr::include_graphics(file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')))
  
}
line_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">
`r source`
</p> 

#### Data call outs
```{r line facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="Income_cat")
# 2021 low income: 20
# 2021 non-low income: 10
# 10-20=-10
# 2011 low income: 6
# 2011 non-low income: 1
# 1-6=-5
# ((-10--5)/(-5))*100: 100% change??


filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="POC_cat")
# 2021 poc: 19
# 2021 non-poc: 9
# 9-19= -10

filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="Older_cat")
# 2021 older: 6
# 2021 non-older: 14
# 14-6=8
# 2011 older: 1
# 2011 non-older: 2
# 2-1= 1
# ((8-1)/(1))*100: 700% change?

filter <- data_clean %>%
  filter(county=="Snohomish",
         focus_type=="POC_cat",
         data_year=="2011" |
           data_year=="2021")
# 2011 king:5-1=4
# 2021 king:20-9=11
# ((11-4)/(4))*100: 175% change
# 2011 kitsap:6-1=5
# 2021 kitsap:16-8=8
# ((8-5)/(5))*100: 60% change
# 2011 pierce:4-1=3
# 2021 pierce:16-9=7
# ((7-3)/(3))*100: 130% change
# 2011 snohomish:5-1=4
# 2021 snohomish:17-8=9
# ((9-4)/(4))*100: 125% change

filter <- data_clean %>%
  filter(focus_type=="Youth_cat",
         data_year=="2011" |
           data_year=="2021")
# king non-low income:150511.89-98506.82=52005.07
# Snohomish non-low income:130900.06-97445.42=33454.64
```

1. 20%: In 2021, households in the region who were below 200% of the poverty line were twice as likely to experience overcrowding compared to households above the 200% poverty line, a 100% larger gap than in 2011
2. 10%: Regionally, people of color experience overcrowding at 10 percentage points higher than white non-Hispanic households, a gap which has more than doubled since 2011
3. 700%: The regional gap between overcrowding in households in the region with older adults compared to households without older adults, has grown 700% since 2011

\

#### Insights & Analysis

* The difference in overcrowding experienced by people with a disability compared to those without a disability between 2016 and 2021 has remained stayed the same in all counties
* The difference in overcrowding for households with people of color and white non-Hispanic over time has differed between counties: shifting dramatically compared to 2011, leading to an over 100% larger gap in King, Pierce, and Snohomish County and by 60% in Pierce County
* The prevalence of overcrowding households below 200% of the poverty line has leveled off from its growth between 2011 to 2016, while the the rates of overcrowding of households above 200% of the poverty line has steadily continued to increase from 2011 and 2021, especially in King County (growing by 8 percentage points)

\
\


# Transfer files
## Copy files from Github > Y drive
```{r to y drive, include=FALSE, eval=FALSE}
# set folder structure
current_folder <- file.path(getwd())
y.drive.folder <- file.path(base_dir,theme_dir,ind_dir)

# isolate files in Github
list.of.files <- list.files(current_folder, 
                            full.names = T,
                            pattern = "\\.(html|docx)$")
# list.of.files

# copy the files to the new folder
file.copy(list.of.files,
          y.drive.folder,
          overwrite = T)

# keep only .Rmd files in Github (cleaner)
files.in.dir <- list.files(current_folder, 
                            full.names = T)
files.to.keep <- list.files(current_folder, 
                            full.names = T,
                            pattern = "\\.Rmd$")
files.to.remove <- list(files.in.dir[!(files.in.dir %in% grep(paste(files.to.keep, collapse = "|"),
                                                              files.in.dir, value=TRUE))])
do.call(unlink, files.to.remove)
```

## Copy files from Y drive > website folder
```{r to web dev folder, include=FALSE, eval=FALSE}
# set folder structure
current_folder <- file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs')

web.base.folder <- '//WEB/website_data/equity-tracker-webpages'
new.folder <- file.path(web.base.folder,theme_dir)

list.of.files <- list.files(current_folder, 
                            full.names = T)
# list.of.files

# copy the files to the new folder
file.copy(list.of.files,
          new.folder,
          overwrite = T)
```

<a href="#top">Back to top of the page</a>