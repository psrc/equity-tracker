---
title: "SNAP"
subtitle: "Visuals for Equity Tracker (PUMS data)"
author: "Kristin Mitchell"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  
  html_document:
    keep_md: yes
    df_print: paged
    toc: yes
    toc_depth: 6
    toc_float: yes
  word_document:
---

```{r rmarkdown setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, 
                      warning=FALSE, 
                      message=FALSE) # formatting

# to reference chart functions in Github
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r library setup, include=FALSE}
# devtools::install_github("psrc/psrcplot",
#                          force=TRUE)
library(psrcplot)
library(tidyverse)
library(magrittr)

library(sf)
library(leaflet)
library(leafem) #home button
library(htmlwidgets) #save visuals as html

install_psrc_fonts()
library(showtext) #trying to fix PSRC font issues
library(sysfonts) #required for showtext
library(showtextdb) #required for showtext

library(echarts4r)
# remotes::install_github("JohnCoene/echarts4r",
#                         force=TRUE)

library(webshot2) #static image creation
```

```{r, choose output type}
# output_type <- "word"
output_type <- "html"
```
# 3 visuals for webpage
This code will help produce the three visuals that are going to be a part of each equity tracker indicator webpage: regional map (tract level) of most recent data, chart of the most recent data, chart of trends over time.
\
\
**If the indicator is a PUMS/OPSI indicator that can be accessed through Elmer.** Getting the data to a workable version may require some data transformation. To explore, clean, transform, and generate a final data set, please use the *data-gen-pums-template*. This script will generate an .rda for the map and an .rda for the charts. These data sets will be loaded in before the data visualization code.  

## Indicator Explanation
Supplemental Nutrition Assistance Program (SNAP) provides low-income households with food benefits. This helps families supplement their food budget and access healthy food options. 

The Census Bureau question asks if an individual or household member has received SNAP benefits in the past 12 months.

## 1. Map of most recent data
To map data in this form, it requires accessing data at the regional/tract level from ACS since the Elmer data set is already aggregated to equity group/quintile. 
```{r map legend settings, include=FALSE}
# https://stackoverflow.com/questions/40276569/reverse-order-in-r-leaflet-continuous-legend - this code helps to set up the legend so that it is arranged high-low with correct color order
addLegend_decreasing <- function (map, position = c("topright", "bottomright", "bottomleft", 
			    "topleft"), pal, values, na.label = "NA", bins = 7, colors, 
		  opacity = 0.5, labels = NULL, labFormat = labelFormat(), 
		  title = NULL, className = "info legend", layerId = NULL, 
		  group = NULL, data = getMapData(map), decreasing = FALSE) {
	position <- match.arg(position)
	type <- "unknown"
	na.color <- NULL
	extra <- NULL
	if (!missing(pal)) {
		if (!missing(colors)) 
			stop("You must provide either 'pal' or 'colors' (not both)")
		if (missing(title) && inherits(values, "formula")) 
			title <- deparse(values[[2]])
		values <- evalFormula(values, data)
		type <- attr(pal, "colorType", exact = TRUE)
		args <- attr(pal, "colorArgs", exact = TRUE)
		na.color <- args$na.color
		if (!is.null(na.color) && col2rgb(na.color, alpha = TRUE)[[4]] == 
		    0) {
			na.color <- NULL
		}
		if (type != "numeric" && !missing(bins)) 
			warning("'bins' is ignored because the palette type is not numeric")
		if (type == "numeric") {
			cuts <- if (length(bins) == 1) 
				pretty(values, bins)
			else bins	
			
			if (length(bins) > 2) 
				if (!all(abs(diff(bins, differences = 2)) <= 
				         sqrt(.Machine$double.eps))) 
					stop("The vector of breaks 'bins' must be equally spaced")
			n <- length(cuts)
			r <- range(values, na.rm = TRUE)
			cuts <- cuts[cuts >= r[1] & cuts <= r[2]]
			n <- length(cuts)
			p <- (cuts - r[1])/(r[2] - r[1])
			extra <- list(p_1 = p[1], p_n = p[n])
			p <- c("", paste0(100 * p, "%"), "")
			if (decreasing == TRUE){
				colors <- pal(rev(c(r[1], cuts, r[2])))
				labels <- rev(labFormat(type = "numeric", cuts))
			}else{
				colors <- pal(c(r[1], cuts, r[2]))
				labels <- rev(labFormat(type = "numeric", cuts))
			}
			colors <- paste(colors, p, sep = " ", collapse = ", ")
			
		}
		else if (type == "bin") {
			cuts <- args$bins
			n <- length(cuts)
			mids <- (cuts[-1] + cuts[-n])/2
			if (decreasing == TRUE){
				colors <- pal(rev(mids))
				labels <- rev(labFormat(type = "bin", cuts))
			}else{
				colors <- pal(mids)
				labels <- labFormat(type = "bin", cuts)
			}
			
		}
		else if (type == "quantile") {
			p <- args$probs
			n <- length(p)
			cuts <- quantile(values, probs = p, na.rm = TRUE)
			mids <- quantile(values, probs = (p[-1] + p[-n])/2, 
				 na.rm = TRUE)
			if (decreasing == TRUE){
				colors <- pal(rev(mids))
				labels <- rev(labFormat(type = "quantile", cuts, p))
			}else{
				colors <- pal(mids)
				labels <- labFormat(type = "quantile", cuts, p)
			}
		}
		else if (type == "factor") {
			v <- sort(unique(na.omit(values)))
			colors <- pal(v)
			labels <- labFormat(type = "factor", v)
			if (decreasing == TRUE){
				colors <- pal(rev(v))
				labels <- rev(labFormat(type = "factor", v))
			}else{
				colors <- pal(v)
				labels <- labFormat(type = "factor", v)
			}
		}
		else stop("Palette function not supported")
		if (!any(is.na(values))) 
			na.color <- NULL
	}
	else {
		if (length(colors) != length(labels)) 
			stop("'colors' and 'labels' must be of the same length")
	}
	legend <- list(colors = I(unname(colors)), labels = I(unname(labels)), 
	               na_color = na.color, na_label = na.label, opacity = opacity, 
	               position = position, type = type, title = title, extra = extra, 
	               layerId = layerId, className = className, group = group)
	invokeMethod(map, data, "addLegend", legend)
}
```

### Create Visual
```{r map .rda}
# load map .rda
base_dir <- 'Y:/Equity Indicators/tracker-webpage-content'
theme_dir <- 'a-regional-health-collaboration'
ind_dir <- 'a05-snap'
rda <- 'a05-snap-map-data.rda'

load(file=file.path(base_dir,theme_dir,ind_dir,"rda-data",rda))
``` 


```{r data format - map, include=FALSE}
#move the decimal point for reg_estimate and cnty_estimate
acs_data_tract <- acs_data_tract %>%
   mutate(reg_estimate = (reg_estimate*100)) %>%
   mutate(cnty_estimate = (cnty_estimate*100))

```

```{r acs map}
# setting map extent
map.lat<- 47.615
map.lon<- -122.257
map.zoom<- 8.5

# check maximum value of data
# summary(acs_data_tract$estimate) # max is 1
max_value <- 60 # this value will be the max value in the legend

# setting color palette
psrc_purple_plus<-c("#FFFFFF", "#FFFFFF", "#F6CEFC", psrc_colors$purples_inc)
acs_data_plus_zero<-append(acs_data_tract$estimate,70)

# psrc_palette <- leaflet::colorNumeric(palette = psrc_purple_plus,
#                                       domain = acs_data_plus_zero) # this is the value field
psrc_palette <- leaflet::colorNumeric(palette = psrc_purple_plus,
                                      domain = c(min(acs_data_plus_zero,na.rm = TRUE),max_value, NA)) # this is the value field

# psrc_palette <- leaflet::colorNumeric(palette=psrc_purple_plus,
#                                       domain = acs_data_tract$estimate)
# psrc_palette <- leaflet::colorNumeric(palette = psrc_purple_plus,
#                                       domain = c(min(acs_data_tract$estimate,na.rm = TRUE),max_value, NA))

# setting the legend/label variables
var_name <- "SNAP <br> Participation" # the <br> could be adjusted depending on the length/spacing of the name
labels <- sprintf(
  "Census tract: <em>%s</em><br/><strong>%s</strong><br/><body>%s</body><br/><body>%s</body><br/><body>%s</bodyD>",
  acs_data_tract$geoid20, # the code in <> makes the geoid value bold/italic
  paste("Tract value: ", 
        prettyNum((round(acs_data_tract$estimate, digits=2))), " %"), 
  paste("Tract data reliability: ", acs_data_tract$reliability),
  paste("Region value: ",
        prettyNum((round(acs_data_tract$reg_estimate, digits=2))), " %"), 
  paste("County value: ",
        prettyNum((round(acs_data_tract$cnty_estimate, digits=2))), " %"), 
  paste0("(",acs_data_tract$county_name," County)")) %>%
  lapply(htmltools::HTML)

# if the label required a suffix instead of a prefix, for example a %, the code would look like this:
# labels <- sprintf(
#   "Census tract: <em>%s</em><br/><strong>%s</strong>", acs_data_tract$geoid20,
#   paste(prettyNum((round(acs_data_tract$estimate, digits=2)), #the digits would probably be 2 for %
#               big.mark = ","), #this wouldn't be necessary to include for %s    
#         '%')) %>%
#   lapply(htmltools::HTML)


# map settings
acs_map <- leaflet() %>%
  leaflet::addMapPane(name = "polygons", zIndex = 410) %>%
  leaflet::addMapPane(name = "maplabels", zIndex = 500) %>% # higher zIndex rendered on top
  leaflet::addProviderTiles("CartoDB.VoyagerNoLabels") %>%
  leaflet::addProviderTiles("CartoDB.VoyagerOnlyLabels",
                            options = leaflet::leafletOptions(pane = "maplabels"),
                            group = "Labels") %>%
  addPolygons(data=acs_data_tract,
              fillColor = psrc_palette(acs_data_plus_zero),
              stroke=FALSE, 
              smoothFactor = 0.2,
              fillOpacity = 0.7,
              group = var_name,
              label = labels) %>% 

  # legend
  addLegend_decreasing(pal = psrc_palette,
                       values = c(min(acs_data_plus_zero,na.rm = TRUE),max_value, NA),
                       #values = c(min(acs_data_tract$estimate,na.rm = TRUE),max_value, NA),
                       position = "bottomright",
                       title = var_name,
                       group = var_name,
                       opacity = 0.7,
                       labFormat = labelFormat(suffix = "%"),
                       decreasing = TRUE) %>% #to get legend high-low with correct color order
  
  # set view extent
  leaflet::setView(lng=map.lon, lat=map.lat, zoom=map.zoom) %>% 
  addEasyButton(easyButton(
    icon = htmltools::span(class = "globe", htmltools::HTML("&#127758;")),  #&#127760; (another emoji option) #"fa-globe", (font awesome icon no longer works because of the conversion to Poppins font below)  
    title ="Region",
    onClick=JS("function(btn, map){map.setView([47.615,-122.257],8.5); }")))

# fixing the legend NA placement (https://github.com/rstudio/leaflet/issues/615)
css_fix <- "div.info.legend.leaflet-control br {clear: both;} html * {font-family: Poppins !important;}" # CSS to correct spacing and font family
html_fix <- htmltools::tags$style(type = "text/css", css_fix) # Convert CSS to HTML
acs_map %<>% htmlwidgets::prependContent(html_fix) # Insert into leaflet HTML code

# printing map
acs_map
```
Source(s): U.S. Census Bureau, 2017-2021 American Community Survey 5-Year Estimates, Table S2201; U.S. Census Bureau, Geography Division 2020 TIGER/Line Shapefiles
```{r generate acs map html, include=FALSE}
# to save html visual to folder, you must create an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\a-regional-health-collaboration\a05-snap\webpage-html-outputs

# set folder structure
map_name <- 'a05-snap-map.html'
  
# interactive webpage output process
htmlwidgets::saveWidget(acs_map,
                        file=file.path(base_dir,theme_dir,ind_dir, 'webpage-html-outputs', map_name))
```
\
\

#### Data call outs
```{r map calculations - pums, include=FALSE, eval=FALSE}
# simplify data set
data <- acs_data_tract %>%
  st_drop_geometry()

# calculate call out information
sort <- data %>% 
  dplyr::arrange(desc(estimate))
# Highest percentage of SNAP participation is 53053940006 (east Tacoma where two low income housing complexes are - 55.2%), 53053061601 (downtown Tacoma - 41.1%), 53033029004 (southeast Des Moines - 39.7%), 53053063301 (east Tacoma just south of 53053940006 - 36.5%)

sort <- data %>% 
  dplyr::arrange(estimate)
# There are 40 census tracts with a 0% participation. 30 tracts in King County, 2 in Kitsap, 4 in Pierce, and 4 in Snohomish 
```

1. 9.0%: The region's average SNAP participation
2. 11.5%: The national average SNAP participation
3. 55.2%: The highest average SNAP participation at census tract level in the region

\

#### Insights & Analysis

* King County has the lowest average for SNAP participation (8.0%), followed by Snohomish (8.8%), Kitsap (10.0%), and Pierce (11.7%)
* There are 40 census tracts with a 0% participation with 30 tracts in King County, 2 in Kitsap, 4 in Pierce, and 4 in Snohomish 
* The four census tracts with the highest participation, east Tacoma (55.2%), Downtown Tacoma (41.1%), southeast Des Moines (39.7%), and east Tacoma (36.5%)

\
\


## 2. Facet of most recent data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r data setup, include=FALSE}
# load visualization functions for charts
# source('C:/Coding/equity-tracker/data-visualization/equity-tracker-chart-functions.R') # this needs to be adjusted based on your local GitHub directory - it is required if you wish to run chunks and view the visuals (without first knitting)
source('equity-tracker-chart-functions.R')

# set folder structure
rda <- 'a05-snap-data.rda'

load(file=file.path(base_dir,theme_dir,ind_dir,"rda-data",rda))
```



```{r data format - column, include=FALSE}

#clean up
data_clean <- data_clean %>%
    filter(indicator_attribute == "Yes") %>%
    filter(fact_type == "share of population")

#move the decimal point for estimate
# acs_data_tract <- acs_data_tract %>%
#    mutate(estimate = (estimate/100))

```

```{r column facet - pums}
# Create Facet Column Chart
data_clean_column <- data_clean %>% 
  dplyr::filter(data_year=="2021") #filter on most recent year

# set variables - adjust as needed (esp. y_min, y_max, dec, esttype, etc.)
df = data_clean_column
geo = "county"
x = "focus_attribute_ord"
y = "fact_value"
facet = "focus_type_ord"
fill = "focus_attribute_ord"
y_min = 0
y_max = .50
dec = 0
esttype = "percent"
color = "purples"
num_colors = 2
color_rev = TRUE
title = "SNAP Participation by Community"
subtitle = "Percent of households participating in SNAP"
#source = "U.S. Census Bureau, 2017-2021 American Community Survey 5-Year Public Use Microdata Sample"

column_chart <- equity_tracker_column_facet(df = df,
                                            geo = geo,
                                            x = x,
                                            y = y,
                                            facet = facet,
                                            title = title,
                                            y_min = y_min,
                                            y_max = y_max,
                                            dec = dec,
                                            esttype = esttype,
                                            color = color,
                                            num_colors = num_colors,
                                            color_rev = color_rev)
```

```{r output final column chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\a-regional-health-collaboration\a05-snap\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\a-regional-health-collaboration\static-images

# set folder structure
file_name <- 'a05-snap-column'

# column Chart - html for interactive
rmarkdown::render("equity-tracker-chart-creator.RMD", 
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                num_colors = num_colors,
                                color_rev = color_rev,
                                title = title,
                                #source = source,
                                subtitle = subtitle),
                  output_file = paste0(file_name, '.html'),
                  output_dir = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs'))

# Column Chart - png for use in static file
# need to create a 'static-images' sub-folder in theme sub-folder if not already existing
webshot2::webshot(url = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs', paste0(file_name, '.html')), 
                  file = file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')), 
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r column chart output - pums, echo=FALSE}

if (output_type == "html") {

  column_chart  
  
} else {
  
  knitr::include_graphics(file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')))
  
}

# column_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">

</p> 

#### Data call outs
```{r column facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean_column %>% 
  filter(county=="Region",
         focus_type=="Income_cat")

# region low income households: .32	
# region non-low income households: .04
# .32-.04=.28

filter <- data_clean_column %>% 
  filter(focus_type=="LEP_cat",
         county=="Region")
# region lep households: .22	
# region non-lep households: .09


filter <- data_clean_column %>% 
  filter(focus_type=="LEP_cat",
         vulnerability=="high vulnerability")

# region lep households: .22	
# king lep households: .23
# kitsap lep households: .09
# pierce lep households: .23
# snohomish lep households: .19

filter <- data_clean_column %>% 
  filter(county=="Region",
         focus_type=="Youth_cat")

# region youth households: .13	
# region non-youth households: .08

filter <- data_clean_column %>% 
  filter(focus_type=="POC_cat")
# region poc: .13
# region non-poc: .07

# snohomish poc: .11
# snohomish non-poc: .08

# king poc: .13
# king non-poc: .06

# kitsap poc: .15
# kitsap non-poc: .09

# pierce poc: .17
# pierce non-poc: .10

filter <- data_clean_column %>% 
  filter(focus_type=="Disability_cat")
# with disability has higher coverage across all counties/region

filter <- data_clean_column %>% 
  filter(focus_type=="Income_cat",
         vulnerability=="high vulnerability") %>% 
  dplyr::arrange(desc(fact_value))

```
As a region:

1. 3.5X: People with a disability are 3.5 times more likely to participate in SNAP 
2. 2X: Limited English proficiency households are twice as likely to participate in SNAP
3. 2X: People of color are twice as likely to participate in SNAP

\

#### Insights & Analysis

* In King County, limited English proficiency households are three times as likely to participate in SNAP
* As a region, 32% of low income households participate in SNAP participation leaving room for increased participation 
* As a region, 4% of non-low income households participate in SNAP which likely due to the broad question asked if an individual or household member participated in SNAP in the past 12 months


\
\


## 3. Facet of trend data
### Create Visual
<style type="text/css">
.main-container {
  max-width: 100% !important;
  margin: auto;
}
</style>

```{r line facet - pums, include=FALSE}
# Create Facet Line Chart

# set variables
df = data_clean
x = "data_year" # different from variables for facet column
fill = "focus_attribute_ord" # different from variables for facet column
color = "blues"
title = "SNAP Participation Trend by Community"
subtitle = "Percent of households participating in SNAP, in 5-year spans between 2011 and 2021"
#source = "U.S. Census Bureau, 2007-2011, 2012-2016, 2017-2021 American Community Survey 5-Year Public Use Microdata Sample"

line_chart <- equity_tracker_line_facet(df = df,
                                        geo = geo,
                                        x = x,
                                        y = y,
                                        fill = fill,
                                        facet = facet,
                                        y_min = y_min,
                                        y_max = y_max,
                                        dec = dec,
                                        esttype = esttype,
                                        color = color,
                                        num_colors = num_colors,
                                        color_rev = color_rev,
                                        width = '420px',
                                        height = '380px')
```

```{r output final line chart - pums, include=FALSE}
# to save html visual to folder, there must be an 'webpage-html-outputs' folder within each indicator sub-folder: Y:\Equity Indicators\tracker-webpage-content\a-regional-health-collaboration\a05-snap\webpage-html-outputs
# to save png visuals to folder, there must be a 'static-images' folder within each thematic sub-folder: Y:\Equity Indicators\tracker-webpage-content\a-regional-health-collaboration\static-images

# set folder structure
file_name <- 'a05-snap-line'

# Line Chart - html for interactive
rmarkdown::render("equity-tracker-chart-creator.RMD", 
                  params = list(df = df,
                                geo = geo,
                                x = x,
                                y = y,
                                fill = fill,
                                facet = facet,
                                y_min = y_min,
                                y_max = y_max,
                                dec = dec,
                                esttype = esttype,
                                color = color,
                                num_colors = num_colors,
                                color_rev = color_rev,
                                title = title,
                                #source = source,
                                subtitle = subtitle,
                                width = '420px',
                                height = '380px',
                                charttype = "line"),
                  output_file = paste0(file_name, '.html'),
                  output_dir = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs'))

# Line Chart - png for use in static file
webshot2::webshot(url = file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs', paste0(file_name, '.html')), 
                  file = file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')), 
                  vwidth = 1920, vheight = 1080)
```

<p style="font-family: Poppins; font-size:14pt; font-weight:bold">
`r title`
</p>
<p style="font-family: Poppins; font-size:12pt; font-weight:normal">
`r subtitle`
</p>
```{r line chart - pums, echo=FALSE}
if (output_type == "html") {

  line_chart  
  
} else {
  
  knitr::include_graphics(file.path(base_dir,theme_dir,'static-images', paste0(file_name, '.png')))
  
}
# line_chart
```
<p style="font-family: Poppins; font-size:10pt; font-style:italic">

</p> 

#### Data call outs
```{r line facet calculations - pums, include=FALSE, eval=FALSE}
# calculate call out information
filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="Income_cat")
# 2021 low income: .32
# 2021 non-low income: .04

# 2016 low income: .37
# 2016 non-low income: .04

# 2011 low income: .32
# 2011 non-low income: .03

filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="POC_cat")
# 2021 poc: .90
# 2021 non-poc: .93
# 2016 poc: .84
# 2016 non-poc: .96
# 118053.44-102481.29=15572.15

filter <- data_clean %>%
  filter(county=="Region",
         focus_type=="Older_cat")


filter <- data_clean %>%
  filter(county != "Region",
         focus_type=="Disability_cat")


filter <- data_clean %>%
  filter(county=="Snohomish",
         focus_type=="POC_cat",
         data_year=="2016" |
           data_year=="2021")


filter <- data_clean %>%
  filter(county=="Snohomish",
         focus_type=="Income_cat",
         vulnerability=="low vulnerability",
         data_year=="2016" |
           data_year=="2021")

```

1. 3.5X: In 2021, people with a disability were 3.5 times more like to participate in SNAP than people without a disability - an increase in disparity since 2016
2. 2X: People of color have consistently been twice as likely to participate in SNAP compared to the white non-Hispanic population
3. 5% point change: From 2016 to 2021, there was a 5% point decrease in SNAP participation for low income families across the region

\

#### Insights & Analysis

* As a region from 2011 to 2021, there was a switch of households with older adults 65+ having higher SNAP participation compared to those without older adults 65+
* From 2011 to 2021, Snohomish County saw the largest decline in disparity for people of color
* As a region, 2016 was a high point for SNAP participation


\
\


# Transfer files
## Copy files from Github > Y drive
```{r to y drive, include=FALSE, eval=FALSE}
# set folder structure
current_folder <- file.path(getwd())
y.drive.folder <- file.path(base_dir,theme_dir,ind_dir)

# isolate files in Github
list.of.files <- list.files(current_folder, 
                            full.names = T,
                            pattern = "\\.(html|docx)$")
# list.of.files

# copy the files to the new folder
file.copy(list.of.files,
          y.drive.folder,
          overwrite = T)

# keep only .Rmd files in Github (cleaner)
files.in.dir <- list.files(current_folder, 
                            full.names = T)
files.to.keep <- list.files(current_folder, 
                            full.names = T,
                            pattern = "\\.Rmd$")
files.to.remove <- list(files.in.dir[!(files.in.dir %in% grep(paste(files.to.keep, collapse = "|"),
                                                              files.in.dir, value=TRUE))])
do.call(unlink, files.to.remove)
```

## Copy files from Y drive > website folder
```{r to web dev folder, include=FALSE, eval=FALSE}
# set folder structure
current_folder <- file.path(base_dir,theme_dir,ind_dir,'webpage-html-outputs')

web.base.folder <- '//WEB/website_data/equity-tracker-webpages'
new.folder <- file.path(web.base.folder,theme_dir)

list.of.files <- list.files(current_folder, 
                            full.names = T)
# list.of.files

# copy the files to the new folder
file.copy(list.of.files,
          new.folder,
          overwrite = T)
```

<a href="#top">Back to top of the page</a>